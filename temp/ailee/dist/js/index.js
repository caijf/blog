"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function responseWord(e){homeController.responseWord(e)}function responsePoem(e){homeController.responsePoem(e)}function responseStatistics(e){resultController.successPostStatistics(e)}var Utils={jump:function(e){location.hash="#&"+e},pageView:function(e){window[e+"Controller"]&&!window[e+"Controller"].__isFirstCreate&&(window[e+"Controller"].__isFirstCreate=!0,window[e+"Controller"].$el=$("#"+e),window[e+"Controller"]&&window[e+"Controller"].onCreate&&window[e+"Controller"].onCreate(),$("#"+e).one($.fx.animationEnd,function(){window[e+"Controller"]&&window[e+"Controller"].onAnimationEnd&&window[e+"Controller"].onAnimationEnd()})),window[e+"Controller"]&&window[e+"Controller"].onShow&&window[e+"Controller"].onShow()},reload:function(){var e=location.href,t=location.hash;e=e.replace(t,""),location.href=e},_hasMask:function(){return this.$mask&&this.$mask.length>0},showMask:function(){this._hasMask()?this.$mask.show():($("body").append('<div class="mask"></div>'),this.$mask=$(".mask"))},hideMask:function(){this.$mask&&this.$mask.hide()},_hasToast:function(){return this.$toast&&this.$toast.length>0},showToast:function(e){this.showMask(),this._hasToast()?this.$toast.html(e).show():($("body").append('<div class="toast">'+e+"</div>"),this.$toast=$(".toast"));var t=this;setTimeout(function(){t.hideToast()},1e3)},hideToast:function(){this.hideMask(),this.$toast&&this.$toast.hide()},_hasLoading:function(){return this.$loading&&this.$loading.length>0},showLoading:function(){this.showMask(),this._hasLoading()?this.$loading.show():($("body").append('<div class="loading"></div>'),this.$loading=$(".loading"))},hideLoading:function(){this.hideMask(),this.$loading&&this.$loading.hide()},_hasBoot:function(){return this.$boot&&this.$boot.length>0},showBoot:function(){if(this.showMask(),this._hasBoot())this.$boot.show();else{var e="",t=this;e+='<div class="score-introduce-md"><div class="close"></div><h2>评分介绍</h2><div class="score-top"><ul><li><span class="display-fraction">10</span><i>1</i><span class="s-text text-tips">平仄</span></li><li><span class="display-fraction">10</span><i>2</i><span class="s-text">对仗</span></li><li><span class="display-fraction">10</span><i>3</i><span class="s-text">押韵</span></li><li><span class="display-fraction fraction-tips">70</span><i>4</i><span class="s-text">内容</span></li></ul></div><div class="attention clearfix"><label>注：</label><div><span>点击可选择字，摁住拖动可选词。长按被选中字词可以修改文字或取消当前选中。</span></div></div><div class="i-confirm s-btn-tips text-center"><button type="button">开始</button></div></div>',$("body").append(e),this.$boot=$(".score-introduce-md"),this.$boot.on("click",".s-btn-tips button",function(){try{localStorage.setItem("techShowBoot",1)}catch(e){console.log("无痕模式")}t.hideBoot(),t.showLoading(),t.jump("pingze"),t.hideLoading()}).on("click",".close",function(){try{localStorage.setItem("techShowBoot",1)}catch(e){console.log("无痕模式")}t.hideBoot()})}},hideBoot:function(){this.hideMask(),this.$boot&&this.$boot.remove(),this.$boot=null}},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),gradeInstance=void 0,Grade=function(){function e(t){_classCallCheck(this,e),this._poemType=t.poemType||"七律",this._rhythmCount=t.rhythmCount||2,this._score=$.extend({pingze:10,rhythm:10,antithesis:10,art:70},t.score),this.pingzeScore=this._score.pingze,this.rhythmScore=this._score.rhythm,this.antithesisScore=this._score.antithesis,this.artScore=this._score.art,this._countScore(),this.updated=!0}return _createClass(e,[{key:"updateScore",value:function(e,t,n){switch(this.updated=!0,e){case"pingze":this._countPinze(t);break;case"rhythm":this._countRhymeScore(t);break;case"antithesis":this._countAntithesis(t);break;case"art":this._countArt(t,n)}this._countScore()}},{key:"_countPinze",value:function(e){this.pingzeScore=this._score.pingze-2*e,this.pingzeScore=this._minZero(this.pingzeScore)}},{key:"_countRhymeScore",value:function(e){this._poemType.indexOf("绝")>-1?this._rhythmCount>2?this.rhythmScore=this._score.rhythm-5*e:this.rhythmScore=this._score.rhythm-10*e:this.rhythmScore=this._score.rhythm-3*e,this.rhythmScore=this._minZero(this.rhythmScore)}},{key:"_countAntithesis",value:function(e){this._poemType.indexOf("绝")>-1?e>0&&(this.antithesisScore-=5):e>0&&(this.antithesisScore=0),this.antithesisScore=this._minZero(this.antithesisScore)}},{key:"_countArt",value:function(e,t){this.artScore=this._minZero(t)}},{key:"_countScore",value:function(){this.allScore=this.pingzeScore+this.rhythmScore+this.antithesisScore+this.artScore,this.allScore=this._minZero(this.allScore)}},{key:"_minZero",value:function(e){return e>0?e:0}}],[{key:"getInstance",value:function(t){return gradeInstance?gradeInstance:gradeInstance=new e(t)}}]),e}();Array.prototype.find||Object.defineProperty(Array.prototype,"find",{enumerable:!1,configurable:!0,writable:!0,value:function e(t){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var e,n=Object(this),i=n.length>>>0,r=arguments[1],o=0;i>o;o++)if(o in n&&(e=n[o],t.call(r,e,o,n)))return e}}),Array.prototype.includes||(Array.prototype.includes=function(e){var t=Object(this),n=parseInt(t.length)||0;if(0===n)return!1;var i,r=parseInt(arguments[1])||0;r>=0?i=r:(i=n+r,0>i&&(i=0));for(var o;n>i;){if(o=t[i],e===o||e!==e&&o!==o)return!0;i++}return!1});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();$(function(){var e={click:"click",draging:"draging",dragEnd:"dragEnd",longClick:"longClick"},t={touch:"touch",mouse:"mouse"},n=void 0,i=void 0;void 0!==window.ontouchstart?(i={start:"touchstart",move:"touchmove",end:"touchend"},n=t.touch):(i={start:"mousedown",move:"mousemove",end:"mouseup"},n=t.mouse);var r=300,o=1e3,a="li",s=function(){function s(t){var n;_classCallCheck(this,s),this._$targetTable=t,this._eventListener=(n={},_defineProperty(n,e.click,[]),_defineProperty(n,e.draging,[]),_defineProperty(n,e.dragEnd,[]),_defineProperty(n,e.longClick,[]),n),this._eventTarget=void 0,this._eventPosition={x:void 0,y:void 0},this._startTime=void 0,this._handlingEvent=!1,this._multiPressed=!1,this._onStart(),this._onMove(),this._onEnd()}return _createClass(s,[{key:"register",value:function(e,t){if("function"==typeof t){var n=this._eventListener[e];Array.isArray(n)&&n.push(t)}}},{key:"_checkTargetTable",value:function(e){return!0}},{key:"_isZepto",value:function(e){return $.zepto.isZ(e)}},{key:"_onStart",value:function(){var e=this;this._$targetTable.on(i.start,a,function(t){return t=e._adaptEventArg(t),e._handlingEvent?e._multiPressed=!0:(e._initEventContext(t),e._startLongClickTimer()),!1})}},{key:"_onMove",value:function(){var t=this;this._$targetTable.on(i.move,a,function(n){if(n=t._adaptEventArg(n),t._handlingEvent&&!t._multiPressed){var i=t._getPosition(n),r=t._getMoveDistance(i);if(t._clickTypeEvent){if(!t._isMoveTooFar(r))return!1;t._clickTypeEvent=!1,t._stopLongClickTime()}if(t._isMoveTooNear(r))return t._dispatchEvent(e.draging,[]),!1;var o=n.target;if(t._lastDragCell===o)return!1;t._lastDragCell=o,t._handleDragingEvent(n)}return!1})}},{key:"_onEnd",value:function(){var e=this;this._$targetTable.on(i.end,a,function(t){return t=e._adaptEventArg(t),e._handlingEvent&&!e._multiPressed&&(e._clickTypeEvent?e._handleClickEvent():e._handleDragEndEvent()),e._uninitEventContext(t),!1})}},{key:"_initEventContext",value:function(e){this._eventTarget=e.target,this._eventPosition=this._getPosition(e),this._startTime=Date.now(),this._clickTypeEvent=!0,this._handlingEvent=!0,this._multiPressed=!1,this._lastDragCell=void 0}},{key:"_uninitEventContext",value:function(e){this._eventTarget=void 0,this._eventPosition=void 0,this._startTime=void 0,this._clickTypeEvent=!1,this._handlingEvent=!1,this._multiPressed=!1,this._lastDragCell=void 0,this._longClickTimer=void 0}},{key:"_startLongClickTimer",value:function(){var t=this;this._longClickTimer=setTimeout(function(){var n=t._getPositionInCellTable(t._eventTarget);t._dispatchEvent(e.longClick,n),t._uninitEventContext()},o)}},{key:"_stopLongClickTime",value:function(){clearTimeout(this._longClickTimer)}},{key:"_getPosition",value:function(e){return{x:e.clientX,y:e.clientY}}},{key:"_getMoveDistance",value:function(e){return{x:Math.abs(e.x-this._eventPosition.x),y:Math.abs(e.y-this._eventPosition.y)}}},{key:"_isMoveTooFar",value:function(e){var t=10;return e.x>t||e.y>t}},{key:"_isMoveTooNear",value:function(e){var t=10;return e.x<=t&&e.y<=t}},{key:"_getTimeDistance",value:function(e){return e-this._startTime}},{key:"_dispatchEvent",value:function(e,t){var n=this._eventListener[e];Array.isArray(n)&&n.forEach(function(e){e(t)})}},{key:"_isClickEvent",value:function(e){return r>e}},{key:"_isLongClickEvent",value:function(e){return e>o}},{key:"_handleClickEvent",value:function(){var t=Date.now(),n=this._getTimeDistance(t);if(this._isClickEvent(n)){var i=this._getPositionInCellTable(this._eventTarget);this._stopLongClickTime(),this._dispatchEvent(e.click,i)}}},{key:"_handleDragingEvent",value:function(t){var n=t.target,i=this._getDragedCellArray(n);this._dispatchEvent(e.draging,i)}},{key:"_handleDragEndEvent",value:function(){this._dispatchEvent(e.dragEnd)}},{key:"_getDragedCellArray",value:function(e){var t=[],n=this._getPositionInCellTable(this._eventTarget),i=this._getPositionInCellTable(e),r=void 0,o=void 0;n.x<=i.x?(r=n.x,o=i.x):(r=i.x,o=n.x);for(var a=r;o>=a;a++)t.push({x:a,y:n.y});return t}},{key:"_getPositionInCellTable",value:function(e){var t=this._getXPositionInCellTable(e),n=this._getYPositionInCellTable(e);return{x:t,y:n}}},{key:"_getXPositionInCellTable",value:function(e){for(var t=0,n=$(e);0!==n.prev().length;)t++,n=n.prev();return t}},{key:"_getYPositionInCellTable",value:function(e){for(var t=0,n=$(e),i=n.parent().parent();0!==i.prev().length;)t++,i=i.prev();return t}},{key:"_adaptEventArg",value:function(e){var i=void 0,r=void 0,o=void 0;if(n===t.touch){if(!(e.touches.length>0))return{clientX:i,clientY:r,target:o};var a=e.touches[0];i=a.clientX,r=a.clientY,o=a.target}else i=e.clientX,r=e.clientY,o=e.target;return{clientX:i,clientY:r,target:View.getElementByPosition(i,r,this._$targetTable)}}}]),s}();window.DOMEvent=s,window.DOMEventType=e});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();$(function(){var e="selected",t="many-selected",n="disable",i="cell",r={mostLeft:"mostLeft",mostRight:"mostRight",normal:"normal"},o=function(){function o(e){_classCallCheck(this,o),this._$targetTable=e}return _createClass(o,[{key:"fillTable",value:function(e){var t=this;this._$targetTable.empty(),e.forEach(function(e){var n=$('<div class = "main-verse"><ul class = "clearfix"></ul></div>'),r=n.find("ul");e.forEach(function(e){var n=e.getPosition(),a=o.generateCellIDByPosition(n),s=$('<li><div class = "text-verse"><span></span></div></li>'),l=s.find("div"),c=l.find("span");c.text(e.getText()),l.attr("id",i+a),t._fillClassToCellElement(l,e),r.append(s)}),t._$targetTable.append(n)}),this._caculateWidthAndHeight()}},{key:"_fillClassToCellElement",value:function(i,r){var o=r.getType();o!==CellType.mark&&(o===CellType.disable?i.addClass(n):o===CellType.chosen?i.addClass(e):o===CellType.coChosen&&(i.addClass(t),i.addClass(e)))}},{key:"updateTable",value:function(e){var t=this;e.forEach(function(e){e.forEach(function(e){var n=e.getPosition(),r=o.generateCellIDByPosition(n),a=t._$targetTable.find("#"+i+r);a.length>0&&t._updateClassToCellElement(a,e)})})}},{key:"_updateClassToCellElement",value:function(n,i){var r=i.getType();r!==CellType.mark&&r!==CellType.disable&&(r===CellType.chosen?(n.addClass(e),n.removeClass(t)):r===CellType.coChosen?(n.addClass(t),n.addClass(e)):(n.removeClass(e),n.removeClass(t)))}},{key:"getCellXPositionType",value:function(e){var t=$(this._$targetTable.children()[0]);if(0===t.length)return r.normal;var n=t.children().length;return 0===e.x?r.mostLeft:e.x===n-1?r.mostRight:r.normal}},{key:"_caculateWidthAndHeight",value:function(){var e=this._$targetTable.find(".main-verse"),t=parseFloat(e.css("height")),n=parseFloat(e.css("padding-top")),i=parseFloat(e.css("padding-bottom")),r=parseFloat(e.css("border-top-width")),a=parseFloat(e.css("border-bottom-width")),s=parseFloat(e.css("margin-top")),l=parseFloat(e.css("margin-bottom")),c=parseFloat(e.css("width")),u=parseFloat(e.css("padding-left")),h=parseFloat(e.css("padding-right")),p=parseFloat(e.css("border-left-width")),f=parseFloat(e.css("border-right-width")),d=parseFloat(e.css("margin-left")),g=parseFloat(e.css("margin-right"));o.rowHeight=t+n+i+r+a+s+l,o.rowWidth=c+u+h+p+f+d+g;var v=e.find("li"),y=parseFloat(v.css("height")),_=parseFloat(v.css("margin-top")),m=parseFloat(v.css("margin-bottom")),C=parseFloat(v.css("width")),k=parseFloat(v.css("margin-left")),w=parseFloat(v.css("margin-right"));o.cellHeight=y+_+m,o.cellWidth=C+k+w}}],[{key:"getElementByPosition",value:function(e,t,n){var i=n,r=i.offset(),a=e-r.left,s=t-r.top,l=Math.floor(a/o.cellWidth),c=Math.floor(s/o.rowHeight),u=$(n.children()[c]),h=u.find("li")[l];return h}},{key:"getCellElementID",value:function(e,t){var n=e.getPosition(),r=o.generateCellIDByPosition(n);return i+r}},{key:"generateCellIDByPosition",value:function(e){return e.x.toString()+e.y.toString()}}]),o}();o.rowWidth=void 0,o.rowHeight=void 0,o.cellWidth=void 0,o.cellHeight=void 0,window.View=o,window.CellXPositionType=r});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();$(function(){var e={unchoose:"unchoose",chosen:"chosen",coChosen:"coChosen",disable:"disable",mark:"mark"},t=function(){function t(n,i){var r=arguments.length<=2||void 0===arguments[2]?e.unchoose:arguments[2];_classCallCheck(this,t),this._cellPosition=i,this._cellText=n,this._cellType=r}return _createClass(t,[{key:"getType",value:function(){return this._cellType}},{key:"setType",value:function(t){void 0!==e[t]&&(this._cellType=t)}},{key:"getText",value:function(){return this._cellText}},{key:"getPosition",value:function(){return this._cellPosition}}],[{key:"equal",value:function(e,t){var n=e.getPosition(),i=t.getPosition();return n.x===i.x&&n.y===i.y}}]),t}();window.Cell=t,window.CellType=e});var _get=function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();$(function(){var e={wujue:"五绝",qijue:"七绝",wulv:"五律",qilv:"七律"},t=function(){function t(e){_classCallCheck(this,t),this._poemString=e}return _createClass(t,[{key:"split",value:function(){for(var e=[],t=0;t<this._totalSentenceCount;t++){var n=this._poemString.slice(t*this._sentenceLength,(t+1)*this._sentenceLength);e.push(n)}return e}}],[{key:"splitPoem",value:function(t){var a=arguments.length<=1||void 0===arguments[1]?e.wujue:arguments[1],s=void 0;switch(a){case e.wujue:return s=new n(t),s.split();case e.qijue:return s=new i(t),s.split();case e.wulv:return s=new r(t),s.split();case e.qilv:return s=new o(t),s.split();default:throw"未知诗词类型"}}}]),t}(),n=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e));return n._totalSentenceCount=4,n._sentenceLength=6,n}return _inherits(t,e),_createClass(t,[{key:"split",value:function(){var e=_get(Object.getPrototypeOf(t.prototype),"split",this).call(this);e=e.map(function(e){return" "+e+" "});var n=["        ","        "];return n.concat(e,n)}}]),t}(t),i=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e));return n._totalSentenceCount=4,n._sentenceLength=8,n}return _inherits(t,e),_createClass(t,[{key:"split",value:function(){var e=_get(Object.getPrototypeOf(t.prototype),"split",this).call(this),n=["        ","        "];return n.concat(e,n)}}]),t}(t),r=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e));return n._totalSentenceCount=8,n._sentenceLength=6,n}return _inherits(t,e),_createClass(t,[{key:"split",value:function(){var e=_get(Object.getPrototypeOf(t.prototype),"split",this).call(this);return e=e.map(function(e){return" "+e+" "})}}]),t}(t),o=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e));return n._totalSentenceCount=8,n._sentenceLength=8,n}return _inherits(t,e),t}(t);window.PoemType=e,window.PoemSpliter=t});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();$(function(){var e=function(){function e(t){_classCallCheck(this,e),this._poemInfo=t}return _createClass(e,[{key:"adaptData",value:function(){var e={};return e.poemArray=this._splitPoem(),e.pingzeArray=this._splitPingze(),e.type=this._poemInfo.PoemContent.Type,e.rhythm=this._loadRhythm(e.type),e.id=this._poemInfo.PoemID,e.userInput=this._poemInfo._userInput,e.extra=this._poemInfo.ExData,e}},{key:"_splitPoem",value:function(){var e=this._poemInfo.PoemContent.Content,t=this._poemInfo.PoemContent.Type;return PoemSpliter.splitPoem(e,t)}},{key:"_splitPingze",value:function(){var e=this._poemInfo.PoemContent.PingZe,t=this._poemInfo.PoemContent.Type;return PoemSpliter.splitPoem(e,t)}},{key:"_loadRhythm",value:function(e){var t=new RhythmLoader(this._poemInfo.PoemContent.Rhythm,e);return t.load()}}]),e}();window.PoemAdapter=e});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();$(function(){var e=function(){function e(t,n){_classCallCheck(this,e),this._rhythm=t,this._poemType=n}return _createClass(e,[{key:"load",value:function(){var e=this;return Object.keys(this._rhythm).map(function(t){return{position:e._getPositionFromRhythmKey(t),value:e._rhythm[t]}})}},{key:"_getPositionFromRhythmKey",value:function(e){var t=/p(\d)_(\d)/,n=t.exec(e);if(!n)throw"错误的韵律";switch(this._poemType){case PoemType.wujue:return{x:parseInt(n[1])-1+2,y:parseInt(n[2])-1+1};case PoemType.qijue:return{x:parseInt(n[1])-1+2,y:parseInt(n[2])-1};case PoemType.wulv:return{x:parseInt(n[1])-1,y:parseInt(n[2])-1+1};case PoemType.qilv:return{x:parseInt(n[1])-1,y:parseInt(n[2])-1};default:throw"unknown poem type"}}}],[{key:"getRhythm",value:function(e,t,n){var i=n.find(function(n){var i=n.position;return i.x===e&&i.y===t});return i?i.value:""}}]),e}();window.RhythmLoader=e});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();$(function(){var e=function(){function e(t){_classCallCheck(this,e),Array.isArray(t)||(t=[t]),this.id=Date.now().toString(),this._isChangeWord=!1,this._cellArray=[],this._remark="",this._changeWord="",this.updateCellArray(t)}return _createClass(e,[{key:"updateCellArray",value:function(e){var t=this,n=e.filter(function(e){return!t._isExistInCellArray(e)});this._cellArray=this._cellArray.concat(n),this._sortCellArray()}},{key:"getCellArray",value:function(){return this._cellArray}},{key:"isChangeWord",value:function(){return this._isChangeWord}},{key:"changeWord",value:function(){this._isChangeWord=!0}},{key:"onChangeWord",value:function(e){this._changeWord=e.target.textContent}},{key:"onRemark",value:function(e){this._remark=e.target.textContent}},{key:"getChangeWord",value:function(){return this._changeWord}},{key:"getRemark",value:function(){return this._remark}},{key:"contains",value:function(e){var t=this._cellArray.find(function(t){return!!Cell.equal(t,e)});return!!t}},{key:"_isExistInCellArray",value:function(e){for(var t=0;t<this._cellArray.length;t++){var n=this._cellArray[t];if(Cell.equal(n,e))return!0}return!1}},{key:"_sortCellArray",value:function(){this._cellArray.sort(function(e,t){var n=e.getPosition(),i=t.getPosition();return n.x<i.x?-1:1})}}],[{key:"equal",value:function(e,t){}}]),e}();window.Stroke=e});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();$(function(){var e=14,t=8,n=160,i=36,r=['<div class = "longClickView">','<div class="Long-press-choice">','<span id = "changeWord" class="barder-tips">改词</span>','<i class = "Long-press-choice-arrow"></i>','<span id = "cancelStroke" class="barder-tips">取消选中</span>',"</div>","</div>"].join(""),o=function(){function o(e,t){_classCallCheck(this,o),this._$targetView=$(r),this._$targetTable=e,this._$targetTable.parent().append(this._$targetView)}return _createClass(o,[{key:"show",value:function(e,t,n,i){var r=this,o=this._$targetTable.find("#"+e),a=o.offset(),s=this._generateElementPosition(a,t);this._$targetTable.offset();this._$targetView.css("width",$(window).width()),this._$targetView.css("height",$(window).height());var l=this._$targetView.find(".Long-press-choice");l.css("left",s.operationBarOffset.x),l.css("top",s.operationBarOffset.y);var c=this._$targetView.find(".Long-press-choice-arrow");c.css("left",s.triangleOffset.x),this._$targetView.find("#changeWord").on("click",function(e){return"function"==typeof n&&n(),r.hide(),!1}),this._$targetView.find("#cancelStroke").on("click",function(e){return"function"==typeof i&&i(),r.hide(),!1}),this._$targetView.on("click",function(){return r.hide(),!1}),this._$targetView.css("display","block")}},{key:"hide",value:function(){this._$targetView.find("#changeWord").off("click"),this._$targetView.find("#cancelStroke").off("click"),this._$targetView.off("click"),this._$targetView.hide()}},{key:"_generateElementPosition",value:function(e,t){var n=void 0;return n=this._isOperationBarTooHigh(e)?this._generateToTopElementPosition(e,t):this._generateCommonElementPosition(e,t)}},{key:"_generateToTopElementPosition",value:function(t,r){var o=this._$targetTable.offset(),a={x:void 0,y:o.top},s={x:"50%",y:o.top+i};return this._isOperationBarTooLeft(t)?(a.x=o.left,s.x=o.left+View.cellWidth*r+View.cellWidth/2-e/2):a.x=t.left+t.width/2-n/2,{operationBarOffset:a,triangleOffset:s}}},{key:"_generateCommonElementPosition",value:function(r,o){var a=this._$targetTable.offset(),s={x:void 0,y:r.top-t-i},l={x:"50%",y:r.top-t};return this._isOperationBarTooLeft(r)?(s.x=a.left,l.x=a.left+View.cellWidth*o+View.cellWidth/2-e/2):s.x=r.left+r.width/2-n/2,{operationBarOffset:s,triangleOffset:l}}},{key:"_isOperationBarTooHigh",value:function(e){var n=this._$targetTable.offset();return e.top-t-i<n.top}},{key:"_isOperationBarTooLeft",value:function(e){var t=this._$targetTable.offset();return e.left+e.width/2-n/2<t.left}}]),o}();window.LongClickView=o});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();$(function(){var e=["<div class = 'item'>","<label class = 'md-head'></label>","<div class = 'md-text'>","<p style = 'display: none;' class = 'changeWordPara'>","<span class='prompt-information'>修改为：</span>","<span contenteditable='true' class = 'changeWord'></span>","</p>","<p class = 'remarkPara'>","<span class='prompt-information'>备注：</span>","<span contenteditable='true' class = 'remark'></span>","</p>","</div>","</div>"].join(""),t=function(){function t(e,n){_classCallCheck(this,t),this._$targetList=e,this._$emptyPanel=n}return _createClass(t,[{key:"fillList",value:function(e){var t=this;this._$targetList.empty(),e.forEach(function(e){var n=t._generateStrokeView(e);t._$targetList.append(n)}),this._toggleEmptyPanel()}},{key:"updateList",value:function(e){var t=this;this._$targetList.children().toArray().forEach(function(t){var n=$(t),i=e.find(function(e){return e.id===n.attr("id")});i||n.remove()}),e.forEach(function(e){var n=(e.id,t._$targetList.children().toArray().find(function(t){var n=$(t);return e.id===n.attr("id")}));if(n){var i=$(n);"none"===i.find(".changeWordPara").css("display")&&e.isChangeWord()&&t._showChangeWord(i)}else{var r=t._generateStrokeView(e);t._$targetList.append(r)}}),this._toggleEmptyPanel()}},{key:"_toggleEmptyPanel",value:function(){this._checkEmpty()?this._showEmptyPanel():this._hideEmptyPanel()}},{key:"_checkEmpty",value:function(){return 0===this._$targetList.children().length}},{key:"_showEmptyPanel",value:function(){this._$emptyPanel.css("display","block")}},{key:"_hideEmptyPanel",value:function(){this._$emptyPanel.css("display","none")}},{key:"_generateStrokeView",value:function(t){var n=$(e);n.attr("id",t.id);var i=n.find(".md-head"),r="",o=t.getCellArray();o.forEach(function(e){var t=e.getText();r+=t}),i.text(r);var a=n.find(".remark");a.on("input",t.onRemark.bind(t));var s=n.find(".changeWord");return s.on("input",t.onChangeWord.bind(t)),t.isChangeWord()?this._showChangeWord(n):this._hideChangeWord(n),n}},{key:"_showChangeWord",value:function(e){e.find(".changeWordPara").css("display","block"),e.find(".changeWordPara").addClass("padding-tips"),e.find(".remarkPara").addClass("remarks-border-top")}},{key:"_hideChangeWord",value:function(e){e.find(".changeWordPara").css("display","none"),e.find(".changeWordPara").removeClass("padding-tips"),e.find(".remarkPara").removeClass("remarks-border-top")}}]),t}();window.StrokeView=t});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();$(function(){var e=[" ",",",".","?","，","。","？"],t=function(){function t(e,n,i){_classCallCheck(this,t),this._poemInfo=e,this._cellTable=this._generateCellTable(e.poemArray),this._strokeArray=[],this._DOMEvent=new DOMEvent(n),this._view=new View(n),this._view.fillTable(this._cellTable);var r=i.closest(".foot").find(".no-info-tips");this._strokeView=new StrokeView(i,r),this._strokeView.fillList(this._strokeArray),this._longClickView=new LongClickView(n),this._dragValid=!0,this._dragingCellArray=[],this._DOMEvent.register(DOMEventType.click,this._handleClickBusiness.bind(this)),this._DOMEvent.register(DOMEventType.longClick,this._handleLongClickBusiness.bind(this)),this._DOMEvent.register(DOMEventType.draging,this._handleDragingBusiness.bind(this)),
this._DOMEvent.register(DOMEventType.dragEnd,this._handleDragEndBusiness.bind(this))}return _createClass(t,[{key:"_generateCellTable",value:function(t){return t.map(function(t,n){var i=t.split("");return i.map(function(t,i,r){var o=void 0;return o=e.includes(t)?new Cell(t,{x:i,y:n},CellType.mark):new Cell(t,{x:i,y:n})})})}},{key:"_handleClickBusiness",value:function(e){var t=this._getCell(e);t.getType()===CellType.unchoose&&this._addClickedCellToStroke(t)}},{key:"_isCellInStroke",value:function(e){var t=this._getRelateStroke(e);return void 0!==t}},{key:"_addClickedCellToStroke",value:function(e){e.setType(CellType.chosen),this._view.updateTable(this._cellTable);var t=new Stroke(e);this._strokeArray.push(t),this._strokeView.updateList(this._strokeArray)}},{key:"_getRelateStroke",value:function(e){return this._strokeArray.find(function(t){return!!t.contains(e)})}},{key:"_handleLongClickBusiness",value:function(e){var t=this._getCell(e),n=t.getType();n!==CellType.chosen&&n!==CellType.coChosen||this._showLongClickView(t)}},{key:"_showLongClickView",value:function(e){var t=this,n=View.getCellElementID(e),i=e.getPosition(),r=(this._view.getCellXPositionType(i),this._getRelateStroke(e));this._longClickView.show(n,i.x,function(){t._changeStrokeWord(r)},function(){t._cancelStroke(r)})}},{key:"_changeStrokeWord",value:function(e){e.changeWord(),this._strokeView.updateList(this._strokeArray)}},{key:"_cancelStroke",value:function(e){var t=e.getCellArray();t.forEach(function(e){e.setType(CellType.unchoose)}),this._removeStroke(e),this._view.updateTable(this._cellTable),this._strokeView.updateList(this._strokeArray)}},{key:"_handleDragingBusiness",value:function(e){var t=this._getDragingCellArrayByPosition(e);this._dragValid=this._checkDragValid(t),this._unchooseDragingCellArray(this._dragingCellArray),this._chooseDragingCellArray(t),this._dragingCellArray=t,this._view.updateTable(this._cellTable)}},{key:"_getDragingCellArrayByPosition",value:function(e){var t=this;return e.map(function(e){return t._getCell(e)}).filter(function(e){var t=e.getType();return t!==CellType.mark&&t!==CellType.disable})}},{key:"_checkDragValid",value:function(e){var t=this,n=e.every(function(e){var n=t._getRelateStroke(e);return void 0===n});return n}},{key:"_unchooseDragingCellArray",value:function(e){var t=this;e.forEach(function(e){var n=t._getRelateStroke(e);void 0===n&&e.setType(CellType.unchoose)})}},{key:"_chooseDragingCellArray",value:function(e){var t=this;e.forEach(function(e){var n=t._getRelateStroke(e);void 0===n&&e.setType(CellType.coChosen)})}},{key:"_handleDragEndBusiness",value:function(){this._dragValid&&this._dragingCellArray.length>0?this._addStroke(this._dragingCellArray):(this._unchooseDragingCellArray(this._dragingCellArray),this._view.updateTable(this._cellTable)),this._recoverDragContext()}},{key:"_addStroke",value:function(e){var t=new Stroke(e);e[e.length-1].setType(CellType.chosen),this._strokeArray.push(t),this._strokeView.updateList(this._strokeArray),this._view.updateTable(this._cellTable)}},{key:"_recoverDragContext",value:function(){this._dragValid=!0,this._dragingCellArray=[]}},{key:"_getCell",value:function(e){return this._cellTable[e.y][e.x]}},{key:"_removeStroke",value:function(e){this._strokeArray=this._strokeArray.filter(function(t){return t!==e})}},{key:"export",value:function(){var e=this;return this._strokeArray.map(function(t){var n=t.getCellArray(),i=n.length,r=n[0].getPosition().y,o=n[0].getPosition().x,a=e._generateCoordString(o,r,i),s=e._generateSourceWord(n),l=t.getRemark(),c=t.getChangeWord(),u={coord:a,sourceword:s,replaceword:c,remark:l,stroke:t};return u})}},{key:"_generateCoordString",value:function(e,t,n){e+=1,t+=1;var i=this._adaptExportCoordString(t,e);return t=i.x,e=i.y,"("+t+","+e+":"+n+")"}},{key:"_adaptExportCoordString",value:function(e,t){switch(this._poemInfo.type){case PoemType.wujue:return{x:e-2,y:t-1};case PoemType.qijue:return{x:e-2,y:t};case PoemType.wulv:return{x:e,y:t-1};case PoemType.qilv:return{x:e,y:t};default:throw"unknown poem type"}}},{key:"_generateSourceWord",value:function(e){var t="";return e.forEach(function(e){t+=e.getText()}),t}}]),t}();window.INVALID_TEXT_ARRAY=e,window.Business=t});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),_get=function n(e,t,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:n(o,t,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)};$(function(){var e=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,Object.getPrototypeOf(t).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"_handleClickBusiness",value:function(e){var t=this._getCell(e),n=this._getTwinCell(t);t.getType()===CellType.unchoose&&n.getType()===CellType.unchoose&&(this._addClickedCellToStroke(t),this._addClickedCellToStroke(n))}},{key:"_generateCellTable",value:function(e){return this._poemInfo.type===PoemType.wulv||this._poemInfo.type===PoemType.qilv?e.map(function(e,t,n){var i=e.split("");return i.map(function(e,i,r){var o=void 0;return o=0===t||1===t||t===n.length-1||t===n.length-2?new Cell(e,{x:i,y:t},CellType.disable):i===r.length-1?new Cell(e,{x:i,y:t},CellType.mark):new Cell(e,{x:i,y:t})})}):_get(Object.getPrototypeOf(t.prototype),"_generateCellTable",this).call(this,e)}},{key:"_cancelStroke",value:function(e){var n=this._getTwinStroke(e);_get(Object.getPrototypeOf(t.prototype),"_cancelStroke",this).call(this,e),_get(Object.getPrototypeOf(t.prototype),"_cancelStroke",this).call(this,n)}},{key:"_getDragingCellArrayByPosition",value:function(e){var n=this,i=_get(Object.getPrototypeOf(t.prototype),"_getDragingCellArrayByPosition",this).call(this,e),r=i.map(function(e){var t=n._getTwinCell(e);return t});return i.concat(r)}},{key:"_handleDragEndBusiness",value:function(){var e=this;if(this._dragValid&&this._dragingCellArray.length>0){var t=this._divideDragingCellArray(this._dragingCellArray);t.forEach(function(t){e._addStroke(t)})}else this._unchooseDragingCellArray(this._dragingCellArray),this._view.updateTable(this._cellTable);this._recoverDragContext()}},{key:"_divideDragingCellArray",value:function(e){var t={},n=[];return e.forEach(function(e){var n=e.getPosition();t[n.y.toString()]=!0}),Object.keys(t).forEach(function(t){var i=e.filter(function(e){var n=e.getPosition();return n.y.toString()===t});n.push(i)}),n}},{key:"_getTwinStroke",value:function(e){var t=this,n=e.getCellArray(),i=n.map(function(e){return t._getTwinCell(e)}),r=this._getRelateStroke(i[0]);return r}},{key:"_getTwinCell",value:function(e){var t=e.getPosition(),n={x:t.x,y:t.y};return t.y%2===1?n.y-=1:n.y+=1,this._getCell(n)}}]),t}(Business);window.DuizhangBusiness=e});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),_get=function i(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:i(o,t,n)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(n)};$(function(){var e=function(e){function t(e,n,i){return _classCallCheck(this,t),_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,n,i))}return _inherits(t,e),_createClass(t,[{key:"_generateCellTable",value:function(e){var t=this;return e.map(function(e,n){var i=e.split("");return i.map(function(e,i,r){var o=void 0;if(INVALID_TEXT_ARRAY.includes(e))o=new Cell(e,{x:i,y:n},CellType.mark);else{var a=t._poemInfo.rhythm.find(function(e){var t=e.position;return t.x===n&&t.y===i});o=void 0!==a?new Cell(e,{x:i,y:n}):new Cell(e,{x:i,y:n},CellType.disable)}return o})})}},{key:"_handleDragingBusiness",value:function(){}},{key:"_handleDragEndBusiness",value:function(){}},{key:"export",value:function(){var e=this,n=_get(Object.getPrototypeOf(t.prototype),"export",this).call(this);return n.map(function(t){var n=t.stroke,i=n.getCellArray(),r=i[0].getPosition().y,o=i[0].getPosition().x,a=e._generateYayunString(r,o);return t.originalrhyme=a,t})}},{key:"_generateYayunString",value:function(e,t){var n=RhythmLoader.getRhythm(e,t,this._poemInfo.rhythm);return n}},{key:"_generateCoordString",value:function(e,t){e+=1,t+=1;var n=this._adaptExportCoordString(t,e);return t=n.x,e=n.y,"("+t+","+e+")"}}]),t}(Business);window.YayunBusiness=e});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),_get=function r(e,t,n){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,t);if(void 0===i){var o=Object.getPrototypeOf(e);return null===o?void 0:r(o,t,n)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(n)};$(function(){function e(e){return 1===parseInt(e)?"平":"仄"}var t=function(t){function n(){return _classCallCheck(this,n),_possibleConstructorReturn(this,Object.getPrototypeOf(n).apply(this,arguments))}return _inherits(n,t),_createClass(n,[{key:"_handleDragingBusiness",value:function(){}},{key:"_handleDragEndBusiness",value:function(){}},{key:"export",value:function(){var e=this,t=_get(Object.getPrototypeOf(n.prototype),"export",this).call(this);return t.map(function(t){var n=t.stroke,i=n.getCellArray(),r=e._generatePingzeWord(i);return t.originalPZ=r,t})}},{key:"_generatePingzeWord",value:function(t){var n=this,i="";return t.forEach(function(t){var r=t.getPosition().y,o=t.getPosition().x,a=n._poemInfo.pingzeArray[r][o];i+=e(a)}),i}},{key:"_generateCoordString",value:function(e,t){e+=1,t+=1;var n=this._adaptExportCoordString(t,e);return t=n.x,e=n.y,"("+t+","+e+")"}}]),n}(Business);window.PingzeBusiness=t}),$(function(){var e=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,Object.getPrototypeOf(t).apply(this,arguments))}return _inherits(t,e),t}(Business);window.NeirongBusiness=e});var poemData={},gradeInstance=null,homeController={urlPoiName:"http://poem.basebiz.ctrip.ccgslb.com.cn/service",urlPoem:"http://poem.basebiz.ctrip.ccgslb.com.cn/GetPoems",inputWord:"",poiName:"",requestWord:function(){var e=this;Utils.showLoading(),$.ajax({type:"GET",url:e.urlPoiName+"?inputword="+e.inputWord,dataType:"jsonp",jsonpCallback:"responseWord",timeout:6e4,error:e.errorHandle.bind(e)})},responseWord:function(e){return""===e.poiname?(Utils.hideLoading(),void Utils.showToast("请输入正确的景点名称")):(this.poiName=e.poiname,this.poiid=e.poiid,void this.requestPoem())},requestPoem:function(){var e=this;$.ajax({type:"GET",url:e.urlPoem+"?Text="+e.inputWord+"&PoiName="+e.poiName,dataType:"jsonp",jsonpCallback:"responsePoem",timeout:6e4,error:e.errorHandle.bind(e)})},responsePoem:function(e){if(e.ResultCode&&"0"!==e.ResultCode)return Utils.hideLoading(),void Utils.showToast("小Lee还在不断学习，请试试其他景点");var t={inputWord:this.inputWord,poiName:this.poiName,poiid:this.poiid};e._userInput=t,Utils.hideLoading(),poemData=new PoemAdapter(e),gradeInstance=new Grade({poemType:e.PoemContent.Type,rhythmCount:Object.keys(e.PoemContent.Rhythm).length}),Utils.jump("create"),this.$el.find("#inputWord").val("")},errorHandle:function(e,t,n){Utils.hideLoading(),Utils.showToast("请检查网络连接后重试")},bindEvent:function(){var e=this,t=$("#createPoem");t.on("click",function(t){var n=$("#inputWord");e.inputWord=n.val().trim(),""===e.inputWord?Utils.showToast("请输入正确的景点名称"):e.requestWord()})},render:function(){this.bindEvent()},onCreate:function(){this.render()}},createController={showBoot:function(){"#&create"!==location.hash||localStorage.getItem("techShowBoot")||Utils.showBoot()},cutString:function(e,t){for(var n=[];""!==e;)n.push(e.substring(0,t)),e=e.substring(t);return n},renderUI:function(){if(poemData&&poemData._poemInfo){var e=poemData._poemInfo.PoemContent,t=e.Content,n=e.Type,i=poemData._poemInfo._userInput.inputWord,r=[];r=n.indexOf("七")>-1?this.cutString(t,8):this.cutString(t,6);var o=this.$el.find(".key-word-text"),a=this.$el.find(".s-verse"),s="";s+="<ul>";for(var l=0,c=r.length;c>l;l++)s+="<li>"+r[l]+"</li>";s+="</ul>",o.html(i),a.html(s)}},bindEvent:function(){this.$el.on("click",".i-confirm button",function(){Utils.jump("pingze")})},render:function(){this.renderUI(),this.bindEvent()},onCreate:function(){this.render(),this.showBoot()}},pingzeController={renderUI:function(){this.$el.find(".p-keyword").append(poemData._poemInfo._userInput.inputWord)},bindEvent:function(){var e=this;this.$el.bind("click",".header .fr",function(){gradeInstance.updateScore("pingze",pingzeBusiness["export"]().length);var t=e.$el.find(".foot");t.hasClass("open-footer-top")&&t.removeClass("open-footer-top").height(t.attr("data-height")+"px"),e.$el.find(".longClickView").hide()})},render:function(){this.renderUI(),this.bindEvent()},onCreate:function(){var e=this,t=this.$el.find(".body-box .p-layout .item"),n=this.$el.find(".foot .strokeList .md-box"),i=new PingzeBusiness(poemData.adaptData(),t,n);window.pingzeBusiness=i,setTimeout(function(){var t=parseFloat(e.$el.find(".header").css("height")),n=parseFloat(e.$el.find(".body-box").css("height")),i=parseFloat(e.$el.css("height")),r=i-n-t;r=r>115?r:115,$(".foot").css("height",r).attr("data-height",r)},100),this.render()}},yayunController={renderUI:function(){this.$el.find(".p-keyword").append(poemData._poemInfo._userInput.inputWord)},bindEvent:function(){var e=this;this.$el.on("click",".header .fr",function(){gradeInstance.updateScore("rhythm",yayunBusiness["export"]().length);var t=e.$el.find(".foot");t.hasClass("open-footer-top")&&t.removeClass("open-footer-top").height(t.attr("data-height")+"px"),e.$el.find(".longClickView").hide()})},render:function(){this.renderUI(),this.bindEvent()},onCreate:function(){var e=this.$el.find(".body-box .p-layout .item"),t=this.$el.find(".foot .strokeList .md-box"),n=new YayunBusiness(poemData.adaptData(),e,t);window.yayunBusiness=n,this.render()}},duizhangController={renderUI:function(){this.$el.find(".p-keyword").append(poemData._poemInfo._userInput.inputWord)},bindEvent:function(){var e=this;this.$el.bind("click",".header .fr",function(){gradeInstance.updateScore("antithesis",duizhangBusiness["export"]().length/2);var t=e.$el.find(".foot");t.hasClass("open-footer-top")&&t.removeClass("open-footer-top").height(t.attr("data-height")),e.$el.find(".longClickView").hide()})},render:function(){this.renderUI(),this.bindEvent()},onCreate:function(){var e=this.$el.find(".body-box .p-layout .item"),t=this.$el.find(".foot .strokeList .md-box"),n=new DuizhangBusiness(poemData.adaptData(),e,t);window.duizhangBusiness=n,this.render()}},neirongController={hasGrade:!1,showPoptipGrade:function(e){var t=this;Utils.showMask(),this.$poptip?this.$poptip.show():(this.$poptip=$('<div class="score-introduce-md"><div class="comment-confirm-text">内容评分您还没有修改哦，<br>确认要50分提交吗？</div><div class="i-confirm s-btn-tips text-center"><button type="button" id="artPoptipCancle">取消</button><button type="button" id="artPoptipOk">确认</button></div></div>'),$("body").append(this.$poptip),this.$poptip.show(),this.$poptip.on("click","#artPoptipOk",function(){t.hidePoptipGrade(),t.updateArtGrade();var e=t.$el.find(".foot");e.hasClass("open-footer-top")&&e.removeClass("open-footer-top").height(e.attr("data-height")+"px"),t.$el.find(".longClickView").hide(),Utils.jump("result")}).on("click","#artPoptipCancle",function(){t.hidePoptipGrade()}))},hidePoptipGrade:function(){Utils.hideMask(),this.$poptip&&this.$poptip.hide()},updateArtGrade:function(){var e=this;gradeInstance.updateScore("art",neirongBusiness["export"]().length,parseInt(e.$el.find('input[type="range"]').val()))},renderUI:function(){this.$el.find(".p-keyword").append(poemData._poemInfo._userInput.inputWord)},bindEvent:function(){var e=this;this.$el.on("click",".header .fr",function(t){if(!e.hasGrade)return e.showPoptipGrade(),t.stopPropagation(),!1;e.updateArtGrade();var n=e.$el.find(".foot");n.hasClass("open-footer-top")&&n.removeClass("open-footer-top").height(n.attr("data-height")+"px"),e.$el.find(".longClickView").hide()});var t=$("#artScoreBar").find(".value");this.$el.find('input[type="range"]').rangeslider({polyfill:!1,rangeClass:"progress",horizontalClass:"progress-horizontal",fillClass:"score-bar-fill",handleClass:"score-bar-handle",onInit:function(){t.css("left",this.position-5+"px")},onSlide:function(n){t.css("left",n-5+"px").html(this.value),e.hasGrade||(e.hasGrade=!0)}})},render:function(){this.renderUI(),this.bindEvent()},onCreate:function(){var e=this.$el.find(".body-box .p-layout .item"),t=this.$el.find(".foot .strokeList .md-box"),n=(this.$el.find(".Long-press-choice"),new NeirongBusiness(poemData.adaptData(),e,t));window.neirongBusiness=n,this.render()},onShow:function(){}},failedController={bindEvent:function(){this.$el.on("click","#failedResubmit",function(){resultController.postStatistics()}).on("click","#failedGoToHome",function(){Utils.reload()})},render:function(){this.bindEvent()},onCreate:function(){this.render()}},resultController={cutString:function(e,t){for(var n=[];""!==e;)n.push(e.substring(0,t)),e=e.substring(t);return n},renderUI:function(){if(poemData&&poemData._poemInfo){var e=poemData._poemInfo.PoemContent,t=e.Content,n=e.Type,i=(poemData._poemInfo._userInput.inputWord,[]),r=this.$el.find(".result-verse"),o="",a=$(window).width();i=n.indexOf("七")>-1?this.cutString(t,8):this.cutString(t,6);for(var s=0,l=i.length;l>s;s++)a>=360||n.indexOf("七")<0?(o+="<p>"+i[s]+i[s+1]+"</p>",s++):o+="<p>"+i[s]+"</p>";r.html(o),this.renderScore()}},renderScore:function(){if(poemData&&poemData._poemInfo){var e=new CountUp("resultScorePingze",0,gradeInstance.pingzeScore,0,0),t=new CountUp("resultScoreDuizhang",0,gradeInstance.antithesisScore,0,0),n=new CountUp("resultScoreYayun",0,gradeInstance.rhythmScore,0,0),i=new CountUp("resultScoreNeirong",0,gradeInstance.artScore,0,0),r=new CountUp("resultScoreAll",0,gradeInstance.allScore,0,2);e.start(),t.start(),n.start(),i.start(),r.start()}},_statisticsPoetize:function(){var e={},t=poemData._poemInfo,n=t.PoemContent,i=t._userInput;return e.inputWord=i.inputWord,e.poiname=i.poiName,e.poiid=i.poiid,e.poemID=t.PoemID,e.poemContent=n.Content,e.judge="",e.poemTime=(new Date).getTime(),e.pingze=n.PingZe,e.rhythm=n.Rhythm,e},_statisticsPingze:function(){var e=[],t=pingzeBusiness["export"](),n={};if(t.length>0)for(var i=0,r=t.length;r>i;i++)n.coord=t[i].coord,n.sourceword=t[i].sourceword,n.originalPZ=t[i].originalPZ,n.replaceword=t[i].replaceword,n.remark=t[i].remark,e.push(n),n={};return e},_statisticsRhyme:function(){var e=[],t=yayunBusiness["export"](),n={};if(t.length>0)for(var i=0,r=t.length;r>i;i++)n.coord=t[i].coord,n.sourceword=t[i].sourceword,n.originalrhyme=t[i].originalrhyme,n.replaceword=t[i].replaceword,n.remark=t[i].remark,e.push(n),n={};return e},_statisticsAntithesis:function(){var e=[],t=duizhangBusiness["export"](),n={};if(t.length>0)for(var i=0,r=t.length;r>i;i++)n.coord1=t[i].coord,n.sourceword1=t[i].sourceword,n.replaceword1=t[i].replaceword,n.remark1=t[i].remark,i++,n.coord2=t[i].coord,n.sourceword2=t[i].sourceword,n.replaceword2=t[i].replaceword,n.remark2=t[i].remark,e.push(n),n={};return e},_statisticsArt:function(){var e=[],t=neirongBusiness["export"](),n={};if(t.length>0)for(var i=0,r=t.length;r>i;i++)n.coord=t[i].coord,n.sourceword=t[i].sourceword,n.replaceword=t[i].replaceword,n.remark=t[i].remark,e.push(n),n={};return e},_statisticsScore:function(){var e={};return e.pingze=gradeInstance.pingzeScore,e.rhythm=gradeInstance.rhythmScore,e.antithesis=gradeInstance.antithesisScore,e.art=gradeInstance.artScore,e.total=gradeInstance.allScore,e},"export":function(){var e={};return e.Poetize=JSON.stringify(this._statisticsPoetize()).replace(/"/g,"'"),e.Pingze=JSON.stringify(this._statisticsPingze()).replace(/"/g,"'"),e.Rhyme=JSON.stringify(this._statisticsRhyme()).replace(/"/g,"'"),e.Antithesis=JSON.stringify(this._statisticsAntithesis()).replace(/"/g,"'"),e.Art=JSON.stringify(this._statisticsArt()).replace(/"/g,"'"),e.Score=JSON.stringify(this._statisticsScore()).replace(/"/g,"'"),e},postStatistics:function(){var e=this;Utils.showLoading();var t="http://101.226.248.140/service/poemsave",n=JSON.stringify(e["export"]());$.ajax({type:"POST",url:t,data:n,success:function(t){e.successPostStatistics.bind(e)(t)},error:function(){e.successPostStatistics.bind(e)()}})},successPostStatistics:function(e){Utils.hideLoading(),Utils.jump("success")},errorHandle:function(){Utils.hideLoading(),Utils.jump("failed")},bindEvent:function(){var e=this;this.$el.on("click",".i-confirm button",function(t){e.postStatistics()})},render:function(){this.renderUI(),this.bindEvent()},onCreate:function(){this.render(),this._statisticsPingze()},onShow:function(){if(poemData&&poemData._poemInfo&&gradeInstance.updated){gradeInstance.updated=!1;var e=parseInt($("#resultScorePingze").html())||0,t=parseInt($("#resultScoreDuizhang").html())||0,n=parseInt($("#resultScoreYayun").html())||0,i=parseInt($("#resultScoreNeirong").html())||0,r=parseInt($("#resultScoreAll").html())||0,o=new CountUp("resultScorePingze",e,gradeInstance.pingzeScore,0,0),a=new CountUp("resultScoreDuizhang",t,gradeInstance.antithesisScore,0,0),s=new CountUp("resultScoreYayun",n,gradeInstance.rhythmScore,0,0),l=new CountUp("resultScoreNeirong",i,gradeInstance.artScore,0,0),c=new CountUp("resultScoreAll",r,gradeInstance.allScore,0,2);o.start(),a.start(),s.start(),l.start(),c.start()}}},successController={onCreate:function(){}};$(function(){var e=null;Mobilebone.callback=function(){var t=location.hash.indexOf("&")>-1?location.hash.substr(2):location.hash.substr(1);poemData&&poemData._poemInfo?"home"===t?setTimeout(function(){Utils.reload()},300):Utils.pageView(t):"failed"!==t&&"success"!==t&&"home"!==t?Utils.jump("home"):Utils.pageView(t),clearTimeout(e),e=setTimeout(function(){var e=location.hash.substr(2);"create"!==e&&Utils.hideBoot()},17)};var t=location.hash.indexOf("&")>-1?location.hash.substr(2):location.hash.substr(1);poemData&&poemData._poemInfo?Utils.pageView(t):"success"!==t?Utils.jump("home"):Utils.pageView(t),$(".jsReload").on("click",function(){Utils.reload()}),$(".strokeList").on("click",".caret",function(){var e=$(this).parents(".foot"),t=$(window).height(),n="open-footer-top";e.hasClass(n)?e.removeClass(n).height(e.attr("data-height")+"px"):e.addClass(n).height(t-120)})});