!function e(t,i,n){function r(a,s){if(!i[a]){if(!t[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var u=i[a]={exports:{}};t[a][0].call(u.exports,function(e){var i=t[a][1][e];return r(i?i:e)},u,u.exports,e,t,i,n)}return i[a].exports}for(var o="function"==typeof require&&require,a=0;a<n.length;a++)r(n[a]);return r}({1:[function(e,t,i){"use strict";var n=e("./common/utils").Utils,r=e("./common/route").Router,o=e("./controllers/home").homeController,a=e("./controllers/generate").generateController,s=e("./controllers/pingze").pingzeController,l=e("./controllers/antithesis").antithesisController,c=e("./controllers/rhythm").rhythmController,u=e("./controllers/art").artController,h=e("./controllers/result").resultController,f=e("./controllers/success").successController,d=e("./controllers/failed").failedController,p=e("./model/poem").PoemAdapter,g={home:o,generate:a,pingze:s,antithesis:l,rhythm:c,art:u,result:h,success:f,failed:d},v=r.extend({routes:{"*path":"ctrl"},ctrl:function(e){var t=p.getInstance();if(t.length()<=0){if("home"!==e)return void setTimeout(function(){n.jump("home")},100)}else"home"===e&&p.destroy();var i=g[e];i&&("undefined"==typeof i._isFirstCreate&&(i._isFirstCreate=!0),i._isFirstCreate&&(i._isFirstCreate=!1,i.$el=$("#"+e),i.onCreate&&i.onCreate()),i.onShow&&i.onShow())}});i.App=v,Object.defineProperty(i,"__esModule",{value:!0})},{"./common/route":5,"./common/utils":6,"./controllers/antithesis":7,"./controllers/art":8,"./controllers/failed":9,"./controllers/generate":10,"./controllers/home":11,"./controllers/pingze":12,"./controllers/result":13,"./controllers/rhythm":14,"./controllers/success":15,"./model/poem":17}],2:[function(e,t,i){"use strict";var n=function(e,t,i){return Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0})},r=function(e,t,i){t&&Object.defineProperties(e,t),i&&Object.defineProperties(e.prototype,i)},o=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},a=e("../view/View").View,s={click:"click",draging:"draging",dragEnd:"dragEnd",longClick:"longClick"},l={touch:"touch",mouse:"mouse"},c=void 0,u=void 0;void 0!==window.ontouchstart?(u={start:"touchstart",move:"touchmove",end:"touchend"},c=l.touch):(u={start:"mousedown",move:"mousemove",end:"mouseup"},c=l.mouse);var h=300,f=600,d="li",p=function(){function e(t){o(this,e),this._$targetTable=t,this._eventListener=function(){var e={};return n(e,s.click,[]),n(e,s.draging,[]),n(e,s.dragEnd,[]),n(e,s.longClick,[]),e}(),this._eventTarget=void 0,this._eventPosition={x:void 0,y:void 0},this._startTime=void 0,this._handlingEvent=!1,this._multiPressed=!1,this._onStart(),this._onMove(),this._onEnd()}return r(e,null,{register:{value:function(e,t){if("function"==typeof t){var i=this._eventListener[e];Array.isArray(i)&&i.push(t)}},writable:!0,configurable:!0},_checkTargetTable:{value:function(e){return!0},writable:!0,configurable:!0},_isZepto:{value:function(e){return $.zepto.isZ(e)},writable:!0,configurable:!0},_onStart:{value:function(){var e=this;this._$targetTable.on(u.start,d,function(t){return t=e._adaptEventArg(t),e._handlingEvent?e._multiPressed=!0:(e._initEventContext(t),e._startLongClickTimer()),!1})},writable:!0,configurable:!0},_onMove:{value:function(){var e=this;this._$targetTable.on(u.move,d,function(t){if(t=e._adaptEventArg(t),e._handlingEvent&&!e._multiPressed){var i=e._getPosition(t),n=e._getMoveDistance(i);if(e._clickTypeEvent){if(!e._isMoveTooFar(n))return!1;e._clickTypeEvent=!1,e._stopLongClickTime()}if(e._isMoveTooNear(n))return e._dispatchEvent(s.draging,[]),!1;var r=t.target;if(e._lastDragCell===r)return!1;e._lastDragCell=r,e._handleDragingEvent(t)}return!1})},writable:!0,configurable:!0},_onEnd:{value:function(){var e=this;this._$targetTable.on(u.end,d,function(t){return t=e._adaptEventArg(t),e._handlingEvent&&!e._multiPressed&&(e._clickTypeEvent?e._handleClickEvent():e._handleDragEndEvent()),e._uninitEventContext(t),!1})},writable:!0,configurable:!0},_initEventContext:{value:function(e){this._eventTarget=e.target,this._eventPosition=this._getPosition(e),this._startTime=Date.now(),this._clickTypeEvent=!0,this._handlingEvent=!0,this._multiPressed=!1,this._lastDragCell=void 0},writable:!0,configurable:!0},_uninitEventContext:{value:function(e){this._eventTarget=void 0,this._eventPosition=void 0,this._startTime=void 0,this._clickTypeEvent=!1,this._handlingEvent=!1,this._multiPressed=!1,this._lastDragCell=void 0,this._longClickTimer=void 0},writable:!0,configurable:!0},_startLongClickTimer:{value:function(){var e=this;this._longClickTimer=setTimeout(function(){var t=e._getPositionInCellTable(e._eventTarget);e._dispatchEvent(s.longClick,t),e._uninitEventContext()},f)},writable:!0,configurable:!0},_stopLongClickTime:{value:function(){clearTimeout(this._longClickTimer)},writable:!0,configurable:!0},_getPosition:{value:function(e){return{x:e.clientX,y:e.clientY}},writable:!0,configurable:!0},_getMoveDistance:{value:function(e){return{x:Math.abs(e.x-this._eventPosition.x),y:Math.abs(e.y-this._eventPosition.y)}},writable:!0,configurable:!0},_isMoveTooFar:{value:function(e){var t=10;return e.x>t||e.y>t},writable:!0,configurable:!0},_isMoveTooNear:{value:function(e){var t=10;return e.x<=t&&e.y<=t},writable:!0,configurable:!0},_getTimeDistance:{value:function(e){return e-this._startTime},writable:!0,configurable:!0},_dispatchEvent:{value:function(e,t){var i=this._eventListener[e];Array.isArray(i)&&i.forEach(function(e){e(t)})},writable:!0,configurable:!0},_isClickEvent:{value:function(e){return h>e},writable:!0,configurable:!0},_isLongClickEvent:{value:function(e){return e>f},writable:!0,configurable:!0},_handleClickEvent:{value:function(){var e=Date.now(),t=this._getTimeDistance(e);if(this._isClickEvent(t)){var i=this._getPositionInCellTable(this._eventTarget);this._stopLongClickTime(),this._dispatchEvent(s.click,i)}},writable:!0,configurable:!0},_handleDragingEvent:{value:function(e){var t=e.target,i=this._getDragedCellArray(t);this._dispatchEvent(s.draging,i)},writable:!0,configurable:!0},_handleDragEndEvent:{value:function(){this._dispatchEvent(s.dragEnd)},writable:!0,configurable:!0},_getDragedCellArray:{value:function(e){var t=[],i=this._getPositionInCellTable(this._eventTarget),n=this._getPositionInCellTable(e),r=void 0,o=void 0;i.x<=n.x?(r=i.x,o=n.x):(r=n.x,o=i.x);for(var a=r;o>=a;a++)t.push({x:a,y:i.y});return t},writable:!0,configurable:!0},_getPositionInCellTable:{value:function(e){var t=this._getXPositionInCellTable(e),i=this._getYPositionInCellTable(e);return{x:t,y:i}},writable:!0,configurable:!0},_getXPositionInCellTable:{value:function(e){for(var t=0,i=$(e);0!==i.prev().length;)t++,i=i.prev();return t},writable:!0,configurable:!0},_getYPositionInCellTable:{value:function(e){for(var t=0,i=$(e),n=i.parent().parent();0!==n.prev().length;)t++,n=n.prev();return t},writable:!0,configurable:!0},_adaptEventArg:{value:function(e){var t=void 0,i=void 0,n=void 0;if(c===l.touch){if(!(e.touches.length>0))return{clientX:t,clientY:i,target:n};var r=e.touches[0];t=r.clientX,i=r.clientY,n=r.target}else{var o=e;t=o.clientX,i=o.clientY,n=o.target}return{clientX:t,clientY:i,target:a.getElementByPosition(t,i,this._$targetTable)}},writable:!0,configurable:!0}}),e}();i.DOMEvent=p,i.DOMEventType=s,Object.defineProperty(i,"__esModule",{value:!0})},{"../view/View":30}],3:[function(e,t,i){"use strict";var n=function l(e,t,i){var n=Object.getOwnPropertyDescriptor(e,t);if(void 0===n){var r=Object.getPrototypeOf(e);return null===r?void 0:l(r,t,i)}if("value"in n&&n.writable)return n.value;var o=n.get;if(void 0!==o)return o.call(i)},r=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)},o=function(e,t,i){t&&Object.defineProperties(e,t),i&&Object.defineProperties(e.prototype,i)},a=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},s=function(){function e(t){a(this,e),this.attributes=t||{}}return o(e,{extend:{value:function(t){var i=void 0,s=function(e){function t(e){a(this,t),n(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e)}return r(t,e),o(t,{getInstance:{value:function(e){return i?i:i=new t(e)},writable:!0,configurable:!0},destroy:{value:function(){i&&(i=null)},writable:!0,configurable:!0}}),t}(e);return s},writable:!0,configurable:!0}},{initilize:{value:function(){},writable:!0,configurable:!0},get:{value:function(e){return e?this.attributes[e]:this.attributes},writable:!0,configurable:!0},set:{value:function(e,t){if(null==e)return this;if($.isPlainObject(e))for(var i in e)this.attributes[i]=e[i];else"string"==typeof e&&t&&(this.attributes[e]=t);return this},writable:!0,configurable:!0},toJson:{value:function(){return JSON.parse(this.attributes)},writable:!0,configurable:!0},length:{value:function(){var e=Object.keys(this.attributes);return e.length},writable:!0,configurable:!0},fetch:{value:function(){},writable:!0,configurable:!0}}),e}();i.Model=s,Object.defineProperty(i,"__esModule",{value:!0})},{}],4:[function(e,t,i){"use strict";var n=function(){Array.prototype.find||Object.defineProperty(Array.prototype,"find",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,i=Object(this),n=i.length>>>0,r=arguments[1],o=0;n>o;o++)if(o in i&&(t=i[o],e.call(r,t,o,i)))return t}}),Array.prototype.includes||(Array.prototype.includes=function(e){var t=Object(this),i=parseInt(t.length)||0;if(0===i)return!1;var n,r=parseInt(arguments[1])||0;r>=0?n=r:(n=i+r,0>n&&(n=0));for(var o;i>n;){if(o=t[n],e===o||e!==e&&o!==o)return!0;n++}return!1}),$.fn.offsetRelativeToBody=function(){var e=$(this),t=e.offset(),i=$("body").offset(),n=e.width(),r=e.height();return{left:t.left-i.left,top:t.top-i.top,width:n,height:r}}};i.polyfill=n,Object.defineProperty(i,"__esModule",{value:!0})},{}],5:[function(e,t,i){"use strict";var n=function l(e,t,i){var n=Object.getOwnPropertyDescriptor(e,t);if(void 0===n){var r=Object.getPrototypeOf(e);return null===r?void 0:l(r,t,i)}if("value"in n&&n.writable)return n.value;var o=n.get;if(void 0!==o)return o.call(i)},r=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)},o=function(e,t,i){t&&Object.defineProperties(e,t),i&&Object.defineProperties(e.prototype,i)},a=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},s=function(){function e(t){a(this,e),this.routes=t&&t.routes||{}}return o(e,{extend:{value:function(t){var i,o=function(e){function i(e){a(this,i),n(Object.getPrototypeOf(i.prototype),"constructor",this).call(this,e),this.routes=t&&t.routes||{}}return r(i,e),i}(e),s=o.prototype;for(i in t)"routes"!=i&&(s[i]=t[i]);return o},writable:!0,configurable:!0}},{start:{value:function(){this._initilize(),this.initilize()},writable:!0,configurable:!0},initilize:{value:function(){},writable:!0,configurable:!0},_initilize:{value:function(){var e=this,t=null,i=/^\*/;Mobilebone.callback=function(){var n,r=location.hash.indexOf("&")>-1?location.hash.substr(2):location.hash.substr(1),o=e.routes;if(e.onChange(r),o[r]){if(!e[o[r]])throw"没有设置控制器";e[o[r]].bind(e)(r)}else{for(n in o)if(i.test(n)){t=e[o[n]];break}if(!t)throw"不存在的路由";t.bind(e)(r)}}},writable:!0,configurable:!0},onChange:{value:function(e){},writable:!0,configurable:!0}}),e}();i.Router=s,Object.defineProperty(i,"__esModule",{value:!0})},{}],6:[function(e,t,i){"use strict";var n=(e("../common/route").Router,e("../model/grade").Grade),r=e("../model/poem").PoemAdapter,o={jump:function(e){location.hash="#&"+e},reload:function(){r.destroy(),n.destroy(),location.reload()},_hasMask:function(){return this.$mask&&this.$mask.length>0},showMask:function(){this._hasMask()?this.$mask.show():($("body").append('<div class="mask"></div>'),this.$mask=$(".mask"))},hideMask:function(){this.$mask&&this.$mask.hide()},_hasToast:function(){return this.$toast&&this.$toast.length>0},showToast:function(e){this.showMask(),this._hasToast()?this.$toast.html(e).show():($("body").append('<div class="toast">'+e+"</div>"),this.$toast=$(".toast"));var t=this;setTimeout(function(){t.hideToast()},1e3)},hideToast:function(){this.hideMask(),this.$toast&&this.$toast.hide()},_hasLoading:function(){return this.$loading&&this.$loading.length>0},showLoading:function(){this.showMask(),this._hasLoading()?this.$loading.show():($("body").append('<div class="loading"></div>'),this.$loading=$(".loading"))},hideLoading:function(){this.hideMask(),this.$loading&&this.$loading.hide()},_hasBoot:function(){return this.$boot&&this.$boot.length>0},showBoot:function(){if(this.showMask(),this._hasBoot())this.$boot.show();else{var e=this,t=['<div class="score-introduce-md">','<div class="close"></div>',"<h2>评分介绍</h2>",'<div class="score-top">',"<ul>","<li>",'<span class="display-fraction">10</span>',"<i>1</i>",'<span class="s-text">平仄</span>',"</li>","<li>",'<span class="display-fraction">10</span>',"<i>2</i>",'<span class="s-text">对仗</span>',"</li>","<li>",'<span class="display-fraction">10</span>',"<i>3</i>",'<span class="s-text">押韵</span>',"</li>","<li>",'<span class="display-fraction fraction-tips">70</span>',"<i>4</i>",'<span class="s-text">内容</span>',"</li>","</ul>","</div>",'<div class="attention clearfix">',"<label>注：</label>","<div>","<span>点击可选择字，摁住拖动可选词。长按被选中字词可以修改文字或取消当前选中。</span>","</div>","</div>",'<div class="i-confirm s-btn-tips text-center">','<button type="button">开始</button>',"</div>","</div>"].join("");this.$boot=$(t),$("body").append(this.$boot),this.$boot.on("click",".s-btn-tips button",function(){try{localStorage.setItem("techShowBoot",1)}catch(t){console.log("无痕模式")}e.hideBoot()}).on("click",".close",function(){try{localStorage.setItem("techShowBoot",1)}catch(t){console.log("无痕模式")}e.hideBoot()})}},hideBoot:function(){this.hideMask(),this.$boot&&this.$boot.remove(),this.$boot=null},_hasScoreDetail:function(){return this.$scoreDetail&&this.$scoreDetail.length>0},showScoreDetail:function(){if(this.showMask(),this.$mask.addClass("score-mask"),this._hasScoreDetail())this.$scoreDetail.show();else{var e=this,t=['<div class="score-details">',"<h1>评分详情</h1>",'<div class="score-content">',"<table>","<thead>","<tr>",'<th width="30%">大类</th>','<th width="15%">小项</th>','<th width="15%">标准分</th>','<th width="40%">打分规则</th>',"</tr>","</thead>","<tbody>","<tr>",'<td rowspan="3">格律<br>30分</td>',"<td>押韵</td>","<td>10分</td>","<td>绝句3个韵的错一个扣5分，2个韵的错一个扣10分律诗错一个扣3分</td>","</tr>","<tr>","<td>对仗</td>","<td>10分</td>","<td>绝句对仗错一个扣3分律诗颔联、颈联对仗错一个扣2分</td>","</tr>","<tr>","<td>平仄</td>","<td>20分</td>","<td>错一个扣2分</td>","</tr>","<tr>",'<td rowspan="3">内容<br>50分</td>',"<td>主题</td>","<td>20分</td>","<td>不切题0-3分，无关词一个扣2分，与主题矛盾的词一个扣5分</td>","</tr>","<tr>","<td>句内<br>语义</td>","<td>15分</td>","<td>有生僻词或语意不连贯绝句一处扣5分，律诗一处扣3分</td>","</tr>","<tr>","<td>句间<br>语义</td>","<td>15分</td>","<td>句间不连贯，绝句一处扣5分，律诗一处扣3分</td>","</tr>","<tr>",'<td rowspan="3">艺术<br>20分</td>',"<td>情感<br>意境</td>","<td>10分</td>","<td>主题、景物、事情无关联一处扣3分</td>","</tr>","<tr>","<td>修辞</td>","<td>5分</td>","<td>有赋比兴且恰当给高分，否则0分</td>","</tr>","<tr>","<td>典故</td>","<td>5分</td>","<td>有用典且恰当给高分，否则0分</td>","</tr>","</tbody>","</table>","</div>","</div>"].join("");this.$scoreDetail=$(t),$("body").append(this.$scoreDetail),this.$scoreDetail.on("click",function(){e.hideScoreDetail()}),this.$mask.on("click",function i(){e.hideScoreDetail(),e.$mask.off("click",i)})}},hideScoreDetail:function(){this.hideMask(),this.$mask.removeClass("score-mask"),this.$scoreDetail.scrollTop(0),this.$scoreDetail.hide()}};i.Utils=o,Object.defineProperty(i,"__esModule",{value:!0})},{"../common/route":5,"../model/grade":16,"../model/poem":17}],7:[function(e,t,i){"use strict";var n=e("../view/BusinessAntithesis").DuizhangBusiness,r=e("../model/grade").Grade,o=e("../model/poem").PoemAdapter,a={renderUI:function(){var e=o.getInstance();e.length()<=0||this.$el.find(".p-keyword").append(e.get("userInput").inputWord)},bindEvent:function(){var e=this;this.$el.bind("click",".header .fr",function(){var t=r.getInstance();if(!(t.length()<=0)){t.updateScore("antithesis",e.business["export"]().length/2);var i=e.$el.find(".foot");i.hasClass("open-footer-top")&&i.removeClass("open-footer-top").height(i.attr("data-height")+"px"),e.$el.find(".longClickView").hide()}})},render:function(){this.renderUI(),this.bindEvent()},onCreate:function(){var e=this.$el.find(".body-box .p-layout .item"),t=this.$el.find(".foot .strokeList .md-box"),i=o.getInstance();i.length()<=0||(this.business=new n(i.adaptData(),e,t),this.render())}};i.antithesisController=a,Object.defineProperty(i,"__esModule",{value:!0})},{"../model/grade":16,"../model/poem":17,"../view/BusinessAntithesis":20}],8:[function(e,t,i){"use strict";var n=e("../common/utils").Utils,r=e("../view/BusinessArt").NeirongBusiness,o=e("../model/grade").Grade,a=e("../model/poem").PoemAdapter,s={hasGrade:!1,showPoptipGrade:function(e){var t=this;n.showMask(),this.$poptip?this.$poptip.show():(this.$poptip=$('<div class="score-introduce-md"><div class="comment-confirm-text">内容评分您还没有修改哦，<br>确认要50分提交吗？</div><div class="i-confirm s-btn-tips text-center"><button type="button" id="artPoptipCancle">取消</button><button type="button" id="artPoptipOk">确认</button></div></div>'),$("body").append(this.$poptip),this.$poptip.show(),this.$poptip.on("click","#artPoptipOk",function(){t.hidePoptipGrade(),t.updateArtGrade();var e=t.$el.find(".foot");e.hasClass("open-footer-top")&&e.removeClass("open-footer-top").height(e.attr("data-height")+"px"),t.$el.find(".longClickView").hide(),n.jump("result")}).on("click","#artPoptipCancle",function(){t.hidePoptipGrade()}))},hidePoptipGrade:function(){n.hideMask(),this.$poptip&&this.$poptip.hide()},updateArtGrade:function(){var e=o.getInstance();e.length()<=0||e.updateScore("art",this.business["export"]().length,parseInt(this.$el.find('input[type="range"]').val()))},renderUI:function(){var e=a.getInstance();e.length()<=0||this.$el.find(".p-keyword").append(e.get("userInput").inputWord)},bindEvent:function(){var e=this;this.$el.on("click",".header .fr",function(t){if(!e.hasGrade)return e.showPoptipGrade(),t.stopPropagation(),!1;e.updateArtGrade();var i=e.$el.find(".foot");i.hasClass("open-footer-top")&&i.removeClass("open-footer-top").height(i.attr("data-height")+"px"),e.$el.find(".longClickView").hide()});var t=$("#artScoreBar").find(".value");this.$el.find('input[type="range"]').rangeslider({polyfill:!1,rangeClass:"progress",horizontalClass:"progress-horizontal",fillClass:"score-bar-fill",handleClass:"score-bar-handle",onInit:function(){t.css("left",this.position-5+"px")},onSlide:function(i){t.css("left",i-5+"px").html(this.value),e.hasGrade||(e.hasGrade=!0)}})},render:function(){this.renderUI(),this.bindEvent()},onCreate:function(){var e=this.$el.find(".body-box .p-layout .item"),t=this.$el.find(".foot .strokeList .md-box"),i=(this.$el.find(".Long-press-choice"),a.getInstance());i.length()<=0||(this.business=new r(i.adaptData(),e,t),this.render())},onShow:function(){}};i.artController=s,Object.defineProperty(i,"__esModule",{value:!0})},{"../common/utils":6,"../model/grade":16,"../model/poem":17,"../view/BusinessArt":21}],9:[function(e,t,i){"use strict";var n=e("../common/utils").Utils,r=e("./result").resultController,o={bindEvent:function(){this.$el.on("click","#failedResubmit",function(){r.postStatistics()}).on("click","#failedGoToHome",function(){n.reload()})},render:function(){this.bindEvent()},onCreate:function(){this.render()}};i.failedController=o,Object.defineProperty(i,"__esModule",{value:!0})},{"../common/utils":6,"./result":13}],10:[function(e,t,i){"use strict";var n=e("../common/utils").Utils,r=e("../model/poem").PoemAdapter,o={cutString:function(e,t){for(var i=[];""!==e;)i.push(e.substring(0,t)),e=e.substring(t);return i},renderUI:function(){var e=r.getInstance();if(!(e.length()<=0)){var t=e.get("PoemContent"),i=t.Content,n=t.Type,o=e.get("userInput").inputWord,a=[];a=n.indexOf("七")>-1?this.cutString(i,8):this.cutString(i,6);var s=this.$el.find(".key-word-text"),l=this.$el.find(".s-verse"),c="";c+="<ul>";for(var u=0,h=a.length;h>u;u++)c+="<li>"+a[u]+"</li>";c+="</ul>",s.html(o),l.html(c)}},bindEvent:function(){this.$el.on("click",".i-confirm button",function(){n.jump("pingze")})},render:function(){this.renderUI(),this.bindEvent()},onCreate:function(){this.render()}};i.generateController=o,Object.defineProperty(i,"__esModule",{value:!0})},{"../common/utils":6,"../model/poem":17}],11:[function(e,t,i){"use strict";var n=e("../common/utils").Utils,r=e("../model/poem").PoemAdapter,o=e("../model/grade").Grade,a=e("../model/user").User;window.responseWord=function(e){c.responseWord(e)},window.responsePoem=function(e){c.responsePoem(e)};var s='<div class="login-box">\n			  	<ul>\n			  		<li>\n			  			<label for="loginName">\n			  				<span class="ico-user"></span>\n			  			</label>\n			  			<div>\n			  				<input type="text" class="user-text" id="loginName" placeholder="用户名">\n			  			</div>\n			  		</li>\n			  		<li>\n			  			<label for="loginPassword">\n			  				<span class="ico-password"></span>\n			  			</label>\n			  			<div>\n			  				<input type="password" class="user-text" id="loginPassword" placeholder="密码">\n			  			</div>\n			  		</li>\n			  	</ul>\n			</div>\n			<div class="i-confirm text-center">\n				<button type="button" id="loginHook">登录</button>\n			</div>',l='<div class="i-body">\n			    <textarea name="" placeholder="请输入一个景点名称" id="inputWord"></textarea>\n			</div>\n			<div class="i-confirm text-center">\n			    <button type="button" id="generatePoem">生成诗</button>\n			</div>',c={urlPoiName:"http://poem.basebiz.ctrip.ccgslb.com.cn/service",urlPoem:"http://poem.basebiz.ctrip.ccgslb.com.cn/GetPoems",urlLogin:"./data/login.json",inputWord:"",poiName:"",requestWord:function(){var e=this;n.showLoading(),$.ajax({type:"GET",url:e.urlPoiName+"?inputword="+e.inputWord,dataType:"jsonp",jsonpCallback:"responseWord",timeout:6e4,error:function(){e.errorHandle.bind(e)()}})},responseWord:function(e){return""===e.poiname?(n.hideLoading(),void n.showToast("请输入正确的景点名称")):(this.poiName=e.poiname,this.poiid=e.poiid,void this.requestPoem())},requestPoem:function(){var e=this;$.ajax({type:"GET",url:e.urlPoem+"?Text="+e.inputWord+"&PoiName="+e.poiName,dataType:"jsonp",jsonpCallback:"responsePoem",timeout:6e4,error:function(){e.errorHandle.bind(e)()}})},responsePoem:function(e){if(e.ResultCode&&"0"!==e.ResultCode)return n.hideLoading(),void n.showToast("小Lee还在不断学习，<br />请试试其他景点");var t={inputWord:this.inputWord,poiName:this.poiName,poiid:this.poiid};e.userInput=t,n.hideLoading();var i=r.getInstance();i.set(e);o.getInstance({poemType:e.PoemContent.Type,rhythmCount:Object.keys(e.PoemContent.Rhythm).length});n.jump("generate"),this.$el.find("#inputWord").val("")},requestLogin:function(e){var t=this;$.ajax({type:"GET",url:t.urlLogin,success:function(e){t.responseLogin.bind(t)(e)},error:function(){t.errorHandle.bind(t)()}})},responseLogin:function(e){for(var t=$.trim($("#loginName").val()),i=$("#loginPassword").val(),r=null,o=0,s=e.length;s>o;o++){var l=e[o].phone,c=e[o].pass;if(parseInt(t)===parseInt(l)&&String(i)===String(c)){r=e[o];break}}if(n.hideLoading(),r){var u=a.getInstance();u.set(r),this.renderUI()}else n.showToast("用户名或密码错误")},errorHandle:function(e,t,i){n.hideLoading(),n.showToast("请检查网络连接后重试")},validataPhone:function(e){var t=/^[1][3578][0-9]{9}$/;return t.test(e)},validataPass:function(e){return""!==e},checkLogin:function(){var e=$.trim($("#loginName").val()),t=$("#loginPassword").val();return this.validataPhone(e)?this.validataPass(t)?{name:e,pass:t}:(n.showToast("密码不能为空"),!1):(n.showToast("手机号格式错误"),!1)},renderUI:function(){var e,t=a.getInstance(),i=$("#homeContainer");e=t.isLogin()?l:s,i.html(e)},bindEvent:function(){var e=this;this.$el.on("click","#generatePoem",function(t){var i=$("#inputWord");e.inputWord=i.val().trim(),""===e.inputWord?n.showToast("请输入正确的景点名称"):e.requestWord()}).on("click","#loginHook",function(){var t=e.checkLogin();t&&(n.showLoading(),e.requestLogin(t))})},render:function(){this.renderUI(),this.bindEvent()},onCreate:function(){this.render()},onShow:function(){}};i.homeController=c,Object.defineProperty(i,"__esModule",{value:!0})},{"../common/utils":6,"../model/grade":16,"../model/poem":17,"../model/user":18}],12:[function(e,t,i){"use strict";var n=e("../common/utils").Utils,r=e("../view/BusinessPingze").PingzeBusiness,o=e("../model/grade").Grade,a=e("../model/poem").PoemAdapter,s={showBoot:function(){"#&pingze"!==location.hash||localStorage.getItem("techShowBoot")||n.showBoot()},renderUI:function(){var e=a.getInstance();e.length()<=0||this.$el.find(".p-keyword").append(e.get("userInput").inputWord)},bindEvent:function(){var e=this;this.$el.bind("click",".header .fr",function(){var t=o.getInstance();if(!(t.length()<=0)){t.updateScore("pingze",e.business["export"]().length);var i=e.$el.find(".foot");i.hasClass("open-footer-top")&&i.removeClass("open-footer-top").height(i.attr("data-height")+"px"),e.$el.find(".longClickView").hide()}})},render:function(){this.renderUI(),this.bindEvent()},onCreate:function(){var e=this,t=this.$el.find(".body-box .p-layout .item"),i=this.$el.find(".foot .strokeList .md-box"),n=a.getInstance();n.length()<=0||(this.business=new r(n.adaptData(),t,i),setTimeout(function(){var t=parseFloat(e.$el.find(".header").css("height")),i=parseFloat(e.$el.find(".body-box").css("height")),n=parseFloat(e.$el.css("height")),r=n-i-t;r=r>115?r:115,$(".foot").css("height",r).attr("data-height",r)},100),this.render(),this.showBoot())}};i.pingzeController=s,Object.defineProperty(i,"__esModule",{value:!0})},{"../common/utils":6,"../model/grade":16,"../model/poem":17,"../view/BusinessPingze":22}],13:[function(e,t,i){"use strict";var n=e("../common/utils").Utils,r=e("../model/grade").Grade,o=e("../model/poem").PoemAdapter,a=e("../model/user").User,s=e("../controllers/pingze").pingzeController,l=e("../controllers/antithesis").antithesisController,c=e("../controllers/rhythm").rhythmController,u=e("../controllers/art").artController;window.responseStatistics=function(e){h.successPostStatistics(e)};var h={cutString:function(e,t){for(var i=[];""!==e;)i.push(e.substring(0,t)),e=e.substring(t);return i},renderUI:function(){var e=o.getInstance();if(!(e.length()<=0)){var t=e.get("PoemContent"),i=t.Content,n=t.Type,r=(e.get("userInput").inputWord,[]),a=this.$el.find(".result-verse"),s="",l=$(window).width();r=n.indexOf("七")>-1?this.cutString(i,8):this.cutString(i,6);for(var c=0,u=r.length;u>c;c++)l>=360||n.indexOf("七")<0?(s+="<p>"+r[c]+r[c+1]+"</p>",c++):s+="<p>"+r[c]+"</p>";a.html(s),this.renderScore()}},renderScore:function(){var e=r.getInstance();if(!(e.length()<=0)){var t=new CountUp("resultScorePingze",0,e.pingzeScore,0,0),i=new CountUp("resultScoreDuizhang",0,e.antithesisScore,0,0),n=new CountUp("resultScoreYayun",0,e.rhythmScore,0,0),o=new CountUp("resultScoreNeirong",0,e.artScore,0,0),a=new CountUp("resultScoreAll",0,e.allScore,0,2);t.start(),i.start(),n.start(),o.start(),a.start()}},_statisticsPoetize:function(){var e={},t=o.getInstance(),i=a.getInstance();if(!(t.length()<=0)){var n=t.get("PoemContent"),r=t.get("userInput");return e.inputWord=r.inputWord,e.poiname=r.poiName,e.poiid=r.poiid,e.poemID=t.get("PoemID"),e.poemContent=n.Content,e.judge="",e.poemTime=(new Date).getTime(),e.pingze=n.PingZe,e.rhythm=n.Rhythm,e.username=i.get("username"),e}},_statisticsPingze:function(){var e=[],t=s.business["export"](),i={};if(t.length>0)for(var n=0,r=t.length;r>n;n++)i.coord=t[n].coord,i.sourceword=t[n].sourceword,i.originalPZ=t[n].originalPZ,i.replaceword=t[n].replaceword,i.remark=t[n].remark,e.push(i),i={};return e},_statisticsRhyme:function(){var e=[],t=c.business["export"](),i={};if(t.length>0)for(var n=0,r=t.length;r>n;n++)i.coord=t[n].coord,i.sourceword=t[n].sourceword,i.originalrhyme=t[n].originalrhyme,i.replaceword=t[n].replaceword,i.remark=t[n].remark,e.push(i),i={};return e},_statisticsAntithesis:function(){var e=[],t=l.business["export"](),i={};if(t.length>0)for(var n=0,r=t.length;r>n;n++)i.coord1=t[n].coord,i.sourceword1=t[n].sourceword,i.replaceword1=t[n].replaceword,i.remark1=t[n].remark,n++,i.coord2=t[n].coord,i.sourceword2=t[n].sourceword,i.replaceword2=t[n].replaceword,i.remark2=t[n].remark,e.push(i),i={};return e},_statisticsArt:function(){var e=[],t=u.business["export"](),i={};if(t.length>0)for(var n=0,r=t.length;r>n;n++)i.coord=t[n].coord,i.sourceword=t[n].sourceword,i.replaceword=t[n].replaceword,i.remark=t[n].remark,e.push(i),i={};return e},_statisticsScore:function(){var e={},t=r.getInstance();return t.length()<=0?void 0:(e.pingze=t.pingzeScore,e.rhythm=t.rhythmScore,e.antithesis=t.antithesisScore,e.art=t.artScore,e.total=t.allScore,e)},"export":function(){var e={};return e.Poetize=JSON.stringify(this._statisticsPoetize()).replace(/"/g,"'"),e.Pingze=JSON.stringify(this._statisticsPingze()).replace(/"/g,"'"),e.Rhyme=JSON.stringify(this._statisticsRhyme()).replace(/"/g,"'"),e.Antithesis=JSON.stringify(this._statisticsAntithesis()).replace(/"/g,"'"),e.Art=JSON.stringify(this._statisticsArt()).replace(/"/g,"'"),e.Score=JSON.stringify(this._statisticsScore()).replace(/"/g,"'"),e},postStatistics:function(){var e=this;n.showLoading();var t="http://101.226.248.140/service/poemsave",i=JSON.stringify(e["export"]());$.ajax({type:"POST",url:t,data:i,success:function(t){e.successPostStatistics.bind(e)(t)},error:function(){e.successPostStatistics.bind(e)()}})},successPostStatistics:function(e){n.hideLoading(),n.jump("success")},errorHandle:function(){n.hideLoading(),n.jump("failed")},bindEvent:function(){var e=this;this.$el.on("click",".i-confirm button",function(t){e.postStatistics()})},render:function(){this.renderUI(),this.bindEvent()},onCreate:function(){this.render(),this._statisticsPingze()},onShow:function(){var e=o.getInstance(),t=r.getInstance();if(!(e.length()<=0)&&!(t.length()<=0)&&t.updated){t.updated=!1;var i=parseInt($("#resultScorePingze").html())||0,n=parseInt($("#resultScoreDuizhang").html())||0,a=parseInt($("#resultScoreYayun").html())||0,s=parseInt($("#resultScoreNeirong").html())||0,l=parseInt($("#resultScoreAll").html())||0,c=new CountUp("resultScorePingze",i,t.pingzeScore,0,0),u=new CountUp("resultScoreDuizhang",n,t.antithesisScore,0,0),h=new CountUp("resultScoreYayun",a,t.rhythmScore,0,0),f=new CountUp("resultScoreNeirong",s,t.artScore,0,0),d=new CountUp("resultScoreAll",l,t.allScore,0,2);c.start(),u.start(),h.start(),f.start(),d.start()}}};i.resultController=h,Object.defineProperty(i,"__esModule",{value:!0})},{"../common/utils":6,"../controllers/antithesis":7,"../controllers/art":8,"../controllers/pingze":12,"../controllers/rhythm":14,"../model/grade":16,"../model/poem":17,"../model/user":18}],14:[function(e,t,i){"use strict";var n=e("../view/BusinessRhythm").YayunBusiness,r=e("../model/grade").Grade,o=e("../model/poem").PoemAdapter,a={renderUI:function(){var e=o.getInstance();e.length()<=0||this.$el.find(".p-keyword").append(e.get("userInput").inputWord)},bindEvent:function(){var e=this;this.$el.on("click",".header .fr",function(){var t=r.getInstance();if(!(t.length()<=0)){t.updateScore("rhythm",e.business["export"]().length);var i=e.$el.find(".foot");i.hasClass("open-footer-top")&&i.removeClass("open-footer-top").height(i.attr("data-height")+"px"),e.$el.find(".longClickView").hide()}})},render:function(){this.renderUI(),this.bindEvent()},onCreate:function(){var e=this.$el.find(".body-box .p-layout .item"),t=this.$el.find(".foot .strokeList .md-box"),i=o.getInstance();
i.length()<=0||(this.business=new n(i.adaptData(),e,t),this.render())}};i.rhythmController=a,Object.defineProperty(i,"__esModule",{value:!0})},{"../model/grade":16,"../model/poem":17,"../view/BusinessRhythm":23}],15:[function(e,t,i){"use strict";var n={onCreate:function(){}};i.successController=n,Object.defineProperty(i,"__esModule",{value:!0})},{}],16:[function(e,t,i){"use strict";var n=function(e,t,i){t&&Object.defineProperties(e,t),i&&Object.defineProperties(e.prototype,i)},r=function u(e,t,i){var n=Object.getOwnPropertyDescriptor(e,t);if(void 0===n){var r=Object.getPrototypeOf(e);return null===r?void 0:u(r,t,i)}if("value"in n&&n.writable)return n.value;var o=n.get;if(void 0!==o)return o.call(i)},o=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)},a=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},s=e("../common/model").Model,l=void 0,c=function(e){function t(e){a(this,t),this._poemType=e.poemType||"七律",this._rhythmCount=e.rhythmCount||2,this._score=$.extend({pingze:10,rhythm:10,antithesis:10,art:70},e.score),this.pingzeScore=this._score.pingze,this.rhythmScore=this._score.rhythm,this.antithesisScore=this._score.antithesis,this.artScore=this._score.art,this._countScore(),this.updated=!0,r(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,this._score)}return o(t,e),n(t,{getInstance:{value:function(e){return l?l:l=new t(e)},writable:!0,configurable:!0},destroy:{value:function(){l&&(l=null)},writable:!0,configurable:!0}},{updateScore:{value:function(e,t,i){switch(this.updated=!0,e){case"pingze":this._countPinze(t);break;case"rhythm":this._countRhymeScore(t);break;case"antithesis":this._countAntithesis(t);break;case"art":this._countArt(t,i)}this._countScore()},writable:!0,configurable:!0},_countPinze:{value:function(e){this.pingzeScore=this._score.pingze-2*e,this.pingzeScore=this._minZero(this.pingzeScore)},writable:!0,configurable:!0},_countRhymeScore:{value:function(e){this._poemType.indexOf("绝")>-1?this._rhythmCount>2?this.rhythmScore=this._score.rhythm-5*e:this.rhythmScore=this._score.rhythm-10*e:this.rhythmScore=this._score.rhythm-3*e,this.rhythmScore=this._minZero(this.rhythmScore)},writable:!0,configurable:!0},_countAntithesis:{value:function(e){this._poemType.indexOf("绝")>-1?e>0&&(this.antithesisScore-=5):e>0&&(this.antithesisScore=0),this.antithesisScore=this._minZero(this.antithesisScore)},writable:!0,configurable:!0},_countArt:{value:function(e,t){this.artScore=this._minZero(t)},writable:!0,configurable:!0},_countScore:{value:function(){this.allScore=this.pingzeScore+this.rhythmScore+this.antithesisScore+this.artScore,this.allScore=this._minZero(this.allScore)},writable:!0,configurable:!0},_minZero:{value:function(e){return e>0?e:0},writable:!0,configurable:!0}}),t}(s);i.Grade=c,Object.defineProperty(i,"__esModule",{value:!0})},{"../common/model":3}],17:[function(e,t,i){"use strict";var n=function(e,t,i){t&&Object.defineProperties(e,t),i&&Object.defineProperties(e.prototype,i)},r=function f(e,t,i){var n=Object.getOwnPropertyDescriptor(e,t);if(void 0===n){var r=Object.getPrototypeOf(e);return null===r?void 0:f(r,t,i)}if("value"in n&&n.writable)return n.value;var o=n.get;if(void 0!==o)return o.call(i)},o=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)},a=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},s=e("../common/model").Model,l=e("../view/PoemSpliter").PoemSpliter,c=e("../view/RhythmLoader").RhythmLoader,u=void 0,h=function(e){function t(e){a(this,t),r(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e)}return o(t,e),n(t,{getInstance:{value:function(e){return u?u:u=new t(e)},writable:!0,configurable:!0},destroy:{value:function(){u&&(u=null)},writable:!0,configurable:!0}},{adaptData:{value:function(){var e={};return e.poemArray=this._splitPoem(),e.pingzeArray=this._splitPingze(),e.type=this.attributes.PoemContent.Type,e.rhythm=this._loadRhythm(e.type),e.id=this.attributes.PoemID,e.userInput=this.attributes.userInput,e.extra=this.attributes.ExData,e},writable:!0,configurable:!0},_splitPoem:{value:function(){var e=this.attributes.PoemContent.Content,t=this.attributes.PoemContent.Type;return l.splitPoem(e,t)},writable:!0,configurable:!0},_splitPingze:{value:function(){var e=this.attributes.PoemContent.PingZe,t=this.attributes.PoemContent.Type;return l.splitPoem(e,t)},writable:!0,configurable:!0},_loadRhythm:{value:function(e){var t=new c(this.attributes.PoemContent.Rhythm,e);return t.load()},writable:!0,configurable:!0}}),t}(s);i.PoemAdapter=h,Object.defineProperty(i,"__esModule",{value:!0})},{"../common/model":3,"../view/PoemSpliter":26,"../view/RhythmLoader":27}],18:[function(e,t,i){"use strict";var n=function(e,t,i){t&&Object.defineProperties(e,t),i&&Object.defineProperties(e.prototype,i)},r=function h(e,t,i){var n=Object.getOwnPropertyDescriptor(e,t);if(void 0===n){var r=Object.getPrototypeOf(e);return null===r?void 0:h(r,t,i)}if("value"in n&&n.writable)return n.value;var o=n.get;if(void 0!==o)return o.call(i)},o=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)},a=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},s=e("../common/model").Model,l=!1,c=void 0,u=function(e){function t(e){a(this,t),r(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),e&&this.set(e),this._updateState()}return o(t,e),n(t,{getInstance:{value:function(e){return c?c:c=new t(e)},writable:!0,configurable:!0},destroy:{value:function(){c&&(c=null)},writable:!0,configurable:!0}},{isLogin:{value:function(e){var t=function(){return e.apply(this,arguments)};return t.toString=function(){return e.toString()},t}(function(){return l}),writable:!0,configurable:!0},get:{value:function(e){var t=this._parseCookieLogin();return e?t[e]:t},writable:!0,configurable:!0},set:{value:function(e,t,i){var n,r=this._parseCookieLogin();if($.isPlainObject(e))r=$.extend({},r,e),n=$.extend({expires:30,path:"/"},t),$.cookie("user",JSON.stringify(r),n);else{if("string"!=typeof e||!value)throw"数据错误";r[e]=value,n=$.extend({expires:30,path:"/"},i),$.cookie("user",JSON.stringify(r),n)}return this._updateState(),this},writable:!0,configurable:!0},_updateState:{value:function(){var e=this._parseCookieLogin();l=!!(e.username&&e.phone&&e.wechat)},writable:!0,configurable:!0},_parseCookieLogin:{value:function(){return $.cookie("user")?JSON.parse($.cookie("user")):{}},writable:!0,configurable:!0}}),t}(s);i.User=u,Object.defineProperty(i,"__esModule",{value:!0})},{"../common/model":3}],19:[function(e,t,i){"use strict";var n=function(e,t,i){t&&Object.defineProperties(e,t),i&&Object.defineProperties(e.prototype,i)},r=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},o=e("../common/DOMEvent"),a=o.DOMEvent,s=o.DOMEventType,l=e("./Cell"),c=l.Cell,u=l.CellType,h=e("./View").View,f=e("./PoemSpliter").PoemType,d=e("./Stroke").Stroke,p=e("./StrokeView").StrokeView,g=e("./LongClickView").LongClickView,v=[" ",",",".","?","，","。","？"],b=function(){function e(t,i,n){r(this,e),this._poemInfo=t,this._cellTable=this._generateCellTable(t.poemArray),this._strokeArray=[],this._DOMEvent=new a(i),this._view=new h(i),this._view.fillTable(this._cellTable);var o=n.closest(".foot").find(".no-info-tips");this._strokeView=new p(n,o),this._strokeView.fillList(this._strokeArray),this._longClickView=new g(i),this._dragValid=!0,this._dragingCellArray=[],this._DOMEvent.register(s.click,this._handleClickBusiness.bind(this)),this._DOMEvent.register(s.longClick,this._handleLongClickBusiness.bind(this)),this._DOMEvent.register(s.draging,this._handleDragingBusiness.bind(this)),this._DOMEvent.register(s.dragEnd,this._handleDragEndBusiness.bind(this))}return n(e,null,{_generateCellTable:{value:function(e){return e.map(function(e,t){var i=e.split("");return i.map(function(e,i,n){var r=void 0;return r=v.includes(e)?new c(e,{x:i,y:t},u.mark):new c(e,{x:i,y:t})})})},writable:!0,configurable:!0},_handleClickBusiness:{value:function(e){var t=this._getCell(e);t.getType()===u.unchoose&&this._addClickedCellToStroke(t)},writable:!0,configurable:!0},_isCellInStroke:{value:function(e){var t=this._getRelateStroke(e);return void 0!==t},writable:!0,configurable:!0},_addClickedCellToStroke:{value:function(e){e.setType(u.chosen),this._view.updateTable(this._cellTable);var t=new d(e);this._strokeArray.push(t),this._strokeView.updateList(this._strokeArray)},writable:!0,configurable:!0},_getRelateStroke:{value:function(e){return this._strokeArray.find(function(t){return!!t.contains(e)})},writable:!0,configurable:!0},_handleLongClickBusiness:{value:function(e){var t=this._getCell(e),i=t.getType();i!==u.chosen&&i!==u.coChosen||this._showLongClickView(t)},writable:!0,configurable:!0},_showLongClickView:{value:function(e){var t=this,i=h.getCellElementID(e),n=e.getPosition(),r=(this._view.getCellXPositionType(n),this._getRelateStroke(e));this._longClickView.show(i,n.x,function(){t._changeStrokeWord(r)},function(){t._cancelStroke(r)})},writable:!0,configurable:!0},_changeStrokeWord:{value:function(e){e.changeWord(),this._strokeView.updateList(this._strokeArray)},writable:!0,configurable:!0},_cancelStroke:{value:function(e){var t=e.getCellArray();t.forEach(function(e){e.setType(u.unchoose)}),this._removeStroke(e),this._view.updateTable(this._cellTable),this._strokeView.updateList(this._strokeArray)},writable:!0,configurable:!0},_handleDragingBusiness:{value:function(e){var t=this._getDragingCellArrayByPosition(e);this._dragValid=this._checkDragValid(t),this._unchooseDragingCellArray(this._dragingCellArray),this._chooseDragingCellArray(t),this._dragingCellArray=t,this._view.updateTable(this._cellTable)},writable:!0,configurable:!0},_getDragingCellArrayByPosition:{value:function(e){var t=this;return e.map(function(e){return t._getCell(e)}).filter(function(e){var t=e.getType();return t!==u.mark&&t!==u.disable})},writable:!0,configurable:!0},_checkDragValid:{value:function(e){var t=this,i=e.every(function(e){var i=t._getRelateStroke(e);return void 0===i});return i},writable:!0,configurable:!0},_unchooseDragingCellArray:{value:function(e){var t=this;e.forEach(function(e){var i=t._getRelateStroke(e);void 0===i&&e.setType(u.unchoose)})},writable:!0,configurable:!0},_chooseDragingCellArray:{value:function(e){var t=this;e.forEach(function(e){var i=t._getRelateStroke(e);void 0===i&&e.setType(u.coChosen)})},writable:!0,configurable:!0},_handleDragEndBusiness:{value:function(){this._dragValid&&this._dragingCellArray.length>0?this._addStroke(this._dragingCellArray):(this._unchooseDragingCellArray(this._dragingCellArray),this._view.updateTable(this._cellTable)),this._recoverDragContext()},writable:!0,configurable:!0},_addStroke:{value:function(e){var t=new d(e);e[e.length-1].setType(u.chosen),this._strokeArray.push(t),this._strokeView.updateList(this._strokeArray),this._view.updateTable(this._cellTable)},writable:!0,configurable:!0},_recoverDragContext:{value:function(){this._dragValid=!0,this._dragingCellArray=[]},writable:!0,configurable:!0},_getCell:{value:function(e){return this._cellTable[e.y][e.x]},writable:!0,configurable:!0},_removeStroke:{value:function(e){this._strokeArray=this._strokeArray.filter(function(t){return t!==e})},writable:!0,configurable:!0},"export":{value:function(){var e=this;return this._strokeArray.map(function(t){var i=t.getCellArray(),n=i.length,r=i[0].getPosition().y,o=i[0].getPosition().x,a=e._generateCoordString(o,r,n),s=e._generateSourceWord(i),l=t.getRemark(),c=t.getChangeWord(),u={coord:a,sourceword:s,replaceword:c,remark:l,stroke:t};return u})},writable:!0,configurable:!0},_generateCoordString:{value:function(e,t,i){e+=1,t+=1;var n=this._adaptExportCoordString(t,e);return t=n.x,e=n.y,"("+t+","+e+":"+i+")"},writable:!0,configurable:!0},_adaptExportCoordString:{value:function(e,t){switch(this._poemInfo.type){case f.wujue:return{x:e-2,y:t-1};case f.qijue:return{x:e-2,y:t};case f.wulv:return{x:e,y:t-1};case f.qilv:return{x:e,y:t};default:throw"unknown poem type"}},writable:!0,configurable:!0},_generateSourceWord:{value:function(e){var t="";return e.forEach(function(e){t+=e.getText()}),t},writable:!0,configurable:!0}}),e}();i.INVALID_TEXT_ARRAY=v,i.Business=b,Object.defineProperty(i,"__esModule",{value:!0})},{"../common/DOMEvent":2,"./Cell":24,"./LongClickView":25,"./PoemSpliter":26,"./Stroke":28,"./StrokeView":29,"./View":30}],20:[function(e,t,i){"use strict";var n=function(e,t,i){t&&Object.defineProperties(e,t),i&&Object.defineProperties(e.prototype,i)},r=function h(e,t,i){var n=Object.getOwnPropertyDescriptor(e,t);if(void 0===n){var r=Object.getPrototypeOf(e);return null===r?void 0:h(r,t,i)}if("value"in n&&n.writable)return n.value;var o=n.get;if(void 0!==o)return o.call(i)},o=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)},a=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},s=e("./Cell").CellType,l=e("./Business").Business,c=e("./PoemSpliter").PoemType,u=function(e){function t(){a(this,t),null!=e&&e.apply(this,arguments)}return o(t,e),n(t,null,{_handleClickBusiness:{value:function(e){var t=this._getCell(e),i=this._getTwinCell(t);t.getType()===s.unchoose&&i.getType()===s.unchoose&&(this._addClickedCellToStroke(t),this._addClickedCellToStroke(i))},writable:!0,configurable:!0},_generateCellTable:{value:function(e){return this._poemInfo.type===c.wulv||this._poemInfo.type===c.qilv?e.map(function(e,t,i){var n=e.split("");return n.map(function(e,n,r){var o=void 0;return o=0===t||1===t||t===i.length-1||t===i.length-2?new Cell(e,{x:n,y:t},s.disable):n===r.length-1?new Cell(e,{x:n,y:t},s.mark):new Cell(e,{x:n,y:t})})}):r(Object.getPrototypeOf(t.prototype),"_generateCellTable",this).call(this,e)},writable:!0,configurable:!0},_cancelStroke:{value:function(e){var i=this._getTwinStroke(e);r(Object.getPrototypeOf(t.prototype),"_cancelStroke",this).call(this,e),r(Object.getPrototypeOf(t.prototype),"_cancelStroke",this).call(this,i)},writable:!0,configurable:!0},_getDragingCellArrayByPosition:{value:function(e){var i=this,n=r(Object.getPrototypeOf(t.prototype),"_getDragingCellArrayByPosition",this).call(this,e),o=n.map(function(e){var t=i._getTwinCell(e);return t});return n.concat(o)},writable:!0,configurable:!0},_handleDragEndBusiness:{value:function(){var e=this;if(this._dragValid&&this._dragingCellArray.length>0){var t=this._divideDragingCellArray(this._dragingCellArray);t.forEach(function(t){e._addStroke(t)})}else this._unchooseDragingCellArray(this._dragingCellArray),this._view.updateTable(this._cellTable);this._recoverDragContext()},writable:!0,configurable:!0},_divideDragingCellArray:{value:function(e){var t={},i=[];return e.forEach(function(e){var i=e.getPosition();t[i.y.toString()]=!0}),Object.keys(t).forEach(function(t){var n=e.filter(function(e){var i=e.getPosition();return i.y.toString()===t});i.push(n)}),i},writable:!0,configurable:!0},_getTwinStroke:{value:function(e){var t=this,i=e.getCellArray(),n=i.map(function(e){return t._getTwinCell(e)}),r=this._getRelateStroke(n[0]);return r},writable:!0,configurable:!0},_getTwinCell:{value:function(e){var t=e.getPosition(),i={x:t.x,y:t.y};return t.y%2===1?i.y-=1:i.y+=1,this._getCell(i)},writable:!0,configurable:!0}}),t}(l);i.DuizhangBusiness=u,Object.defineProperty(i,"__esModule",{value:!0})},{"./Business":19,"./Cell":24,"./PoemSpliter":26}],21:[function(e,t,i){"use strict";var n=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)},r=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},o=e("./Business").Business,a=function(e){function t(){r(this,t),null!=e&&e.apply(this,arguments)}return n(t,e),t}(o);i.NeirongBusiness=a,Object.defineProperty(i,"__esModule",{value:!0})},{"./Business":19}],22:[function(e,t,i){"use strict";function n(e){return 1===parseInt(e)?"平":"仄"}var r=function(e,t,i){t&&Object.defineProperties(e,t),i&&Object.defineProperties(e.prototype,i)},o=function u(e,t,i){var n=Object.getOwnPropertyDescriptor(e,t);if(void 0===n){var r=Object.getPrototypeOf(e);return null===r?void 0:u(r,t,i)}if("value"in n&&n.writable)return n.value;var o=n.get;if(void 0!==o)return o.call(i)},a=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)},s=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},l=e("./Business").Business,c=function(e){function t(){s(this,t),null!=e&&e.apply(this,arguments)}return a(t,e),r(t,null,{_handleDragingBusiness:{value:function(){},writable:!0,configurable:!0},_handleDragEndBusiness:{value:function(){},writable:!0,configurable:!0},"export":{value:function(){var e=this,i=o(Object.getPrototypeOf(t.prototype),"export",this).call(this);return i.map(function(t){var i=t.stroke,n=i.getCellArray(),r=e._generatePingzeWord(n);return t.originalPZ=r,t})},writable:!0,configurable:!0},_generatePingzeWord:{value:function(e){var t=this,i="";return e.forEach(function(e){var r=e.getPosition().y,o=e.getPosition().x,a=t._poemInfo.pingzeArray[r][o];i+=n(a)}),i},writable:!0,configurable:!0},_generateCoordString:{value:function(e,t){e+=1,t+=1;var i=this._adaptExportCoordString(t,e);return t=i.x,e=i.y,"("+t+","+e+")"},writable:!0,configurable:!0}}),t}(l);i.PingzeBusiness=c,Object.defineProperty(i,"__esModule",{value:!0})},{"./Business":19}],23:[function(e,t,i){"use strict";var n=function(e,t,i){t&&Object.defineProperties(e,t),i&&Object.defineProperties(e.prototype,i)},r=function g(e,t,i){var n=Object.getOwnPropertyDescriptor(e,t);if(void 0===n){var r=Object.getPrototypeOf(e);return null===r?void 0:g(r,t,i)}if("value"in n&&n.writable)return n.value;var o=n.get;if(void 0!==o)return o.call(i)},o=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)},a=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},s=e("./Business"),l=s.Business,c=s.INVALID_TEXT_ARRAY,u=e("./RhythmLoader").RhythmLoader,h=e("./Cell.js"),f=h.Cell,d=h.CellType,p=function(e){function t(e,i,n){a(this,t),r(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e,i,n)}return o(t,e),n(t,null,{_generateCellTable:{value:function(e){var t=this;return e.map(function(e,i){var n=e.split("");return n.map(function(e,n,r){var o=void 0;if(c.includes(e))o=new f(e,{x:n,y:i},d.mark);else{var a=t._poemInfo.rhythm.find(function(e){var t=e.position;return t.x===i&&t.y===n});o=void 0!==a?new f(e,{x:n,y:i}):new f(e,{x:n,y:i},d.disable)}return o})})},writable:!0,configurable:!0},_handleDragingBusiness:{value:function(){},writable:!0,configurable:!0},_handleDragEndBusiness:{value:function(){},writable:!0,configurable:!0},"export":{value:function(){var e=this,i=r(Object.getPrototypeOf(t.prototype),"export",this).call(this);return i.map(function(t){var i=t.stroke,n=i.getCellArray(),r=n[0].getPosition().y,o=n[0].getPosition().x,a=e._generateYayunString(r,o);return t.originalrhyme=a,t})},writable:!0,configurable:!0},_generateYayunString:{value:function(e,t){var i=u.getRhythm(e,t,this._poemInfo.rhythm);return i},writable:!0,configurable:!0},_generateCoordString:{value:function(e,t){e+=1,t+=1;var i=this._adaptExportCoordString(t,e);return t=i.x,e=i.y,"("+t+","+e+")"},writable:!0,configurable:!0}}),t}(l);i.YayunBusiness=p,Object.defineProperty(i,"__esModule",{value:!0})},{"./Business":19,"./Cell.js":24,"./RhythmLoader":27}],24:[function(e,t,i){"use strict";var n=function(e,t,i){t&&Object.defineProperties(e,t),i&&Object.defineProperties(e.prototype,i)},r=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},o={unchoose:"unchoose",chosen:"chosen",coChosen:"coChosen",disable:"disable",mark:"mark"},a=function(){function e(t,i){var n=void 0===arguments[2]?o.unchoose:arguments[2];r(this,e),this._cellPosition=i,this._cellText=t,this._cellType=n}return n(e,{equal:{value:function(e,t){var i=e.getPosition(),n=t.getPosition();return i.x===n.x&&i.y===n.y},writable:!0,configurable:!0}},{getType:{value:function(){return this._cellType},writable:!0,configurable:!0},setType:{value:function(e){void 0!==o[e]&&(this._cellType=e)},writable:!0,configurable:!0},getText:{value:function(){return this._cellText},writable:!0,configurable:!0},getPosition:{value:function(){return this._cellPosition},writable:!0,configurable:!0}}),e}();i.Cell=a,i.CellType=o,Object.defineProperty(i,"__esModule",{value:!0})},{}],25:[function(e,t,i){"use strict";var n=function(e,t,i){t&&Object.defineProperties(e,t),i&&Object.defineProperties(e.prototype,i)},r=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},o=e("./View").View,a=14,s=8,l=160,c=36,u=['<div class = "longClickView">','<div class="Long-press-choice">','<span id = "changeWord" class="barder-tips">改词</span>','<i class = "Long-press-choice-arrow"></i>','<span id = "cancelStroke" class="barder-tips">取消选中</span>',"</div>","</div>"].join(""),h=function(){function e(t,i){r(this,e),this._$targetView=$(u),this._$targetTable=t,this._$targetTable.parent().append(this._$targetView)}return n(e,null,{show:{value:function(e,t,i,n){var r=this,o=this._$targetTable.find("#"+e),a=o.offsetRelativeToBody(),s=this._generateElementPosition(a,t);this._$targetView.css("width",$(window).width()),this._$targetView.css("height",$(window).height());var l=this._$targetView.find(".Long-press-choice");l.css("left",s.operationBarOffset.x),l.css("top",s.operationBarOffset.y);var c=this._$targetView.find(".Long-press-choice-arrow");c.css("left",s.triangleOffset.x);var u=o.parents(".body-box");u.css({position:"relative",zIndex:999}),this._$targetView.find("#changeWord").on("click",function(t){return"function"==typeof i&&i(),r.hide(e),!1}),this._$targetView.find("#cancelStroke").on("click",function(t){return"function"==typeof n&&n(),r.hide(e),!1}),this._$targetView.on("click",function(){return r.hide(e),!1}),this._$targetView.css("display","block")},writable:!0,configurable:!0},hide:{value:function(e){this._$targetView.find("#changeWord").off("click"),this._$targetView.find("#cancelStroke").off("click"),this._$targetView.off("click"),this._$targetView.hide();var t=this._$targetTable.find("#"+e),i=t.parents(".body-box");i.css({position:"static",zIndex:1})},writable:!0,configurable:!0},_generateElementPosition:{value:function(e,t){var i=void 0;return i=this._isOperationBarTooHigh(e)?this._generateToTopElementPosition(e,t):this._generateCommonElementPosition(e,t)},writable:!0,configurable:!0},_generateToTopElementPosition:{value:function(e,t){var i=this._$targetTable.offsetRelativeToBody(),n={x:void 0,y:i.top},r={x:"50%",y:i.top+c};return this._isOperationBarTooLeft(e)?(n.x=i.left,r.x=i.left+o.cellWidth*t+o.cellWidth/2-a/2):n.x=e.left+e.width/2-l/2,{operationBarOffset:n,triangleOffset:r}},writable:!0,configurable:!0},_generateCommonElementPosition:{value:function(e,t){var i=this._$targetTable.offsetRelativeToBody(),n={x:void 0,y:e.top-s-c},r={x:"50%",y:e.top-s};return this._isOperationBarTooLeft(e)?(n.x=i.left,r.x=i.left+o.cellWidth*t+o.cellWidth/2-a/2):n.x=e.left+e.width/2-l/2,{operationBarOffset:n,triangleOffset:r}},writable:!0,configurable:!0},_isOperationBarTooHigh:{value:function(e){var t=this._$targetTable.offsetRelativeToBody();return e.top-s-c<t.top},writable:!0,configurable:!0},_isOperationBarTooLeft:{value:function(e){var t=this._$targetTable.offsetRelativeToBody();return e.left+e.width/2-l/2<t.left},writable:!0,configurable:!0}}),e}();i.LongClickView=h,Object.defineProperty(i,"__esModule",{value:!0})},{"./View":30}],26:[function(e,t,i){"use strict";var n=function d(e,t,i){var n=Object.getOwnPropertyDescriptor(e,t);if(void 0===n){var r=Object.getPrototypeOf(e);return null===r?void 0:d(r,t,i)}if("value"in n&&n.writable)return n.value;var o=n.get;if(void 0!==o)return o.call(i)},r=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)},o=function(e,t,i){t&&Object.defineProperties(e,t),i&&Object.defineProperties(e.prototype,i)},a=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},s={wujue:"五绝",qijue:"七绝",wulv:"五律",qilv:"七律"},l=function(){function e(t){a(this,e),this._poemString=t}return o(e,{splitPoem:{value:function(e){var t=void 0===arguments[1]?s.wujue:arguments[1],i=void 0;switch(t){case s.wujue:return i=new c(e),i.split();case s.qijue:return i=new u(e),i.split();case s.wulv:return i=new h(e),i.split();case s.qilv:return i=new f(e),i.split();default:throw"未知诗词类型"}},writable:!0,configurable:!0}},{split:{value:function(){for(var e=[],t=0;t<this._totalSentenceCount;t++){var i=this._poemString.slice(t*this._sentenceLength,(t+1)*this._sentenceLength);e.push(i)}return e},writable:!0,configurable:!0}}),e}(),c=function(e){function t(e){a(this,t),n(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this._totalSentenceCount=4,this._sentenceLength=6}return r(t,e),o(t,null,{split:{value:function(){var e=n(Object.getPrototypeOf(t.prototype),"split",this).call(this);e=e.map(function(e){return" "+e+" "});var i=["        ","        "];return i.concat(e,i)},writable:!0,configurable:!0}}),t}(l),u=function(e){function t(e){a(this,t),n(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this._totalSentenceCount=4,this._sentenceLength=8}return r(t,e),o(t,null,{split:{value:function(){var e=n(Object.getPrototypeOf(t.prototype),"split",this).call(this),i=["        ","        "];return i.concat(e,i)},writable:!0,configurable:!0}}),t}(l),h=function(e){function t(e){a(this,t),n(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this._totalSentenceCount=8,this._sentenceLength=6}return r(t,e),o(t,null,{split:{value:function(){var e=n(Object.getPrototypeOf(t.prototype),"split",this).call(this);return e=e.map(function(e){return" "+e+" "})},writable:!0,configurable:!0}}),t}(l),f=function(e){function t(e){a(this,t),n(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this._totalSentenceCount=8,this._sentenceLength=8}return r(t,e),t}(l);i.PoemType=s,i.PoemSpliter=l,Object.defineProperty(i,"__esModule",{value:!0})},{}],27:[function(e,t,i){"use strict";var n=function(e,t,i){t&&Object.defineProperties(e,t),i&&Object.defineProperties(e.prototype,i)},r=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},o=e("./PoemSpliter").PoemType,a=function(){function e(t,i){r(this,e),this._rhythm=t,this._poemType=i}return n(e,{getRhythm:{value:function(e,t,i){var n=i.find(function(i){var n=i.position;return n.x===e&&n.y===t});return n?n.value:""},writable:!0,configurable:!0}},{load:{value:function(){var e=this;return Object.keys(this._rhythm).map(function(t){return{position:e._getPositionFromRhythmKey(t),value:e._rhythm[t]}})},writable:!0,configurable:!0},_getPositionFromRhythmKey:{value:function(e){var t=/p(\d)_(\d)/,i=t.exec(e);if(!i)throw"错误的韵律";switch(this._poemType){case o.wujue:return{x:parseInt(i[1])-1+2,y:parseInt(i[2])-1+1};case o.qijue:return{x:parseInt(i[1])-1+2,y:parseInt(i[2])-1};case o.wulv:return{x:parseInt(i[1])-1,y:parseInt(i[2])-1+1};case o.qilv:return{x:parseInt(i[1])-1,y:parseInt(i[2])-1};default:throw"unknown poem type"}},writable:!0,configurable:!0}}),e}();i.RhythmLoader=a,Object.defineProperty(i,"__esModule",{value:!0})},{"./PoemSpliter":26}],28:[function(e,t,i){"use strict";var n=function(e,t,i){t&&Object.defineProperties(e,t),i&&Object.defineProperties(e.prototype,i)},r=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},o=e("./Cell").Cell,a=(e("./View").View,function(){function e(t){r(this,e),Array.isArray(t)||(t=[t]),this.id=Date.now().toString(),this._isChangeWord=!1,this._cellArray=[],this._remark="",this._changeWord="",this.updateCellArray(t)}return n(e,{equal:{value:function(e,t){},writable:!0,configurable:!0}},{updateCellArray:{value:function(e){var t=this,i=e.filter(function(e){return!t._isExistInCellArray(e)});this._cellArray=this._cellArray.concat(i),this._sortCellArray()},writable:!0,configurable:!0},getCellArray:{value:function(){return this._cellArray},writable:!0,configurable:!0},isChangeWord:{value:function(){return this._isChangeWord},writable:!0,configurable:!0},changeWord:{value:function(){this._isChangeWord=!0},writable:!0,configurable:!0},onChangeWord:{value:function(e){this._changeWord=e.target.textContent},writable:!0,configurable:!0},onRemark:{value:function(e){this._remark=e.target.textContent},writable:!0,configurable:!0},getChangeWord:{value:function(){return this._changeWord},writable:!0,configurable:!0},getRemark:{value:function(){return this._remark},writable:!0,configurable:!0},contains:{value:function(e){var t=this._cellArray.find(function(t){return!!o.equal(t,e)});return!!t},writable:!0,configurable:!0},_isExistInCellArray:{value:function(e){for(var t=0;t<this._cellArray.length;t++){var i=this._cellArray[t];if(o.equal(i,e))return!0}return!1},writable:!0,configurable:!0},_sortCellArray:{value:function(){this._cellArray.sort(function(e,t){var i=e.getPosition(),n=t.getPosition();return i.x<n.x?-1:1})},writable:!0,configurable:!0}}),e}());i.Stroke=a,Object.defineProperty(i,"__esModule",{value:!0})},{"./Cell":24,"./View":30}],29:[function(e,t,i){"use strict";var n=function(e,t,i){t&&Object.defineProperties(e,t),i&&Object.defineProperties(e.prototype,i)},r=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},o=["<div class = 'item'>","<label class = 'md-head'></label>","<div class = 'md-text'>","<p style = 'display: none;' class = 'changeWordPara'>","<span class='prompt-information'>修改为：</span>","<span contenteditable='true' class = 'changeWord'></span>","</p>","<p class = 'remarkPara'>","<span class='prompt-information'>备注：</span>","<span contenteditable='true' class = 'remark'></span>","</p>","</div>","</div>"].join(""),a=function(){function e(t,i){r(this,e),this._$targetList=t,this._$emptyPanel=i}return n(e,null,{fillList:{value:function(e){var t=this;this._$targetList.empty(),e.forEach(function(e){var i=t._generateStrokeView(e);t._$targetList.append(i)}),this._toggleEmptyPanel()},writable:!0,configurable:!0},updateList:{value:function(e){var t=this;this._$targetList.children().toArray().forEach(function(t){var i=$(t),n=e.find(function(e){return e.id===i.attr("id")});n||i.remove()}),e.forEach(function(e){var i=(e.id,t._$targetList.children().toArray().find(function(t){var i=$(t);return e.id===i.attr("id")}));if(i){var n=$(i);"none"===n.find(".changeWordPara").css("display")&&e.isChangeWord()&&t._showChangeWord(n);
}else{var r=t._generateStrokeView(e);t._$targetList.append(r)}}),this._toggleEmptyPanel()},writable:!0,configurable:!0},_toggleEmptyPanel:{value:function(){this._checkEmpty()?this._showEmptyPanel():this._hideEmptyPanel()},writable:!0,configurable:!0},_checkEmpty:{value:function(){return 0===this._$targetList.children().length},writable:!0,configurable:!0},_showEmptyPanel:{value:function(){this._$emptyPanel.css("display","block")},writable:!0,configurable:!0},_hideEmptyPanel:{value:function(){this._$emptyPanel.css("display","none")},writable:!0,configurable:!0},_generateStrokeView:{value:function(e){var t=$(o);t.attr("id",e.id);var i=t.find(".md-head"),n="",r=e.getCellArray();r.forEach(function(e){var t=e.getText();n+=t}),i.text(n);var a=t.find(".remark");a.on("input",e.onRemark.bind(e));var s=t.find(".changeWord");return s.on("input",e.onChangeWord.bind(e)),e.isChangeWord()?this._showChangeWord(t):this._hideChangeWord(t),t},writable:!0,configurable:!0},_showChangeWord:{value:function(e){e.find(".changeWordPara").css("display","block"),e.find(".changeWordPara").addClass("padding-tips"),e.find(".remarkPara").addClass("remarks-border-top")},writable:!0,configurable:!0},_hideChangeWord:{value:function(e){e.find(".changeWordPara").css("display","none"),e.find(".changeWordPara").removeClass("padding-tips"),e.find(".remarkPara").removeClass("remarks-border-top")},writable:!0,configurable:!0}}),e}();i.StrokeView=a,Object.defineProperty(i,"__esModule",{value:!0})},{}],30:[function(e,t,i){"use strict";var n=function(e,t,i){t&&Object.defineProperties(e,t),i&&Object.defineProperties(e.prototype,i)},r=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},o=e("./Cell").CellType,a="selected",s="many-selected",l="disable",c="cell",u={mostLeft:"mostLeft",mostRight:"mostRight",normal:"normal"},h=function(){function e(t){r(this,e),this._$targetTable=t}return n(e,{getElementByPosition:{value:function(t,i,n){var r=n,o=r.offset(),a=t-o.left,s=i-o.top,l=Math.floor(a/e.cellWidth),c=Math.floor(s/e.rowHeight),u=$(n.children()[c]),h=u.find("li")[l];return h},writable:!0,configurable:!0},getCellElementID:{value:function(t,i){var n=t.getPosition(),r=e.generateCellIDByPosition(n);return c+r},writable:!0,configurable:!0},generateCellIDByPosition:{value:function(e){return e.x.toString()+e.y.toString()},writable:!0,configurable:!0}},{fillTable:{value:function(t){var i=this;this._$targetTable.empty(),t.forEach(function(t){var n=$('<div class = "main-verse"><ul class = "clearfix"></ul></div>'),r=n.find("ul");t.forEach(function(t){var n=t.getPosition(),o=e.generateCellIDByPosition(n),a=$('<li><div class = "text-verse"><span></span></div></li>'),s=a.find("div"),l=s.find("span");l.text(t.getText()),s.attr("id",c+o),i._fillClassToCellElement(s,t),r.append(a)}),i._$targetTable.append(n)}),this._caculateWidthAndHeight()},writable:!0,configurable:!0},_fillClassToCellElement:{value:function(e,t){var i=t.getType();i!==o.mark&&(i===o.disable?e.addClass(l):i===o.chosen?e.addClass(a):i===o.coChosen&&(e.addClass(s),e.addClass(a)))},writable:!0,configurable:!0},updateTable:{value:function(t){var i=this;t.forEach(function(t){t.forEach(function(t){var n=t.getPosition(),r=e.generateCellIDByPosition(n),o=i._$targetTable.find("#"+c+r);o.length>0&&i._updateClassToCellElement(o,t)})})},writable:!0,configurable:!0},_updateClassToCellElement:{value:function(e,t){var i=t.getType();i!==o.mark&&i!==o.disable&&(i===o.chosen?(e.addClass(a),e.removeClass(s)):i===o.coChosen?(e.addClass(s),e.addClass(a)):(e.removeClass(a),e.removeClass(s)))},writable:!0,configurable:!0},getCellXPositionType:{value:function(e){var t=$(this._$targetTable.children()[0]);if(0===t.length)return u.normal;var i=t.children().length;return 0===e.x?u.mostLeft:e.x===i-1?u.mostRight:u.normal},writable:!0,configurable:!0},_caculateWidthAndHeight:{value:function(){var t=this._$targetTable.find(".main-verse"),i=parseFloat(t.css("height")),n=parseFloat(t.css("padding-top")),r=parseFloat(t.css("padding-bottom")),o=parseFloat(t.css("border-top-width")),a=parseFloat(t.css("border-bottom-width")),s=parseFloat(t.css("margin-top")),l=parseFloat(t.css("margin-bottom")),c=parseFloat(t.css("width")),u=parseFloat(t.css("padding-left")),h=parseFloat(t.css("padding-right")),f=parseFloat(t.css("border-left-width")),d=parseFloat(t.css("border-right-width")),p=parseFloat(t.css("margin-left")),g=parseFloat(t.css("margin-right"));e.rowHeight=i+n+r+o+a+s+l,e.rowWidth=c+u+h+f+d+p+g;var v=t.find("li"),b=parseFloat(v.css("height")),_=parseFloat(v.css("margin-top")),y=parseFloat(v.css("margin-bottom")),m=parseFloat(v.css("width")),w=parseFloat(v.css("margin-left")),C=parseFloat(v.css("margin-right"));e.cellHeight=b+_+y,e.cellWidth=m+w+C},writable:!0,configurable:!0}}),e}();h.rowWidth=void 0,h.rowHeight=void 0,h.cellWidth=void 0,h.cellHeight=void 0,i.View=h,i.CellXPositionType=u,Object.defineProperty(i,"__esModule",{value:!0})},{"./Cell":24}],31:[function(e,t,i){"use strict";var n=e("./js/common/polyfill").polyfill,r=e("./js/common/utils").Utils,o=e("./js/app").App;n();var a=new o;a.start(),$(".jsReload").on("click",function(){r.reload()}),$(".strokeList").on("click",".caret",function(){var e=$(this).parents(".foot"),t=$(window).height(),i="open-footer-top";e.hasClass(i)?e.removeClass(i).height(e.attr("data-height")+"px"):e.addClass(i).height(t-120)}),$(".header .title").on("click",function(){var e=$(this);e.find(".ico-i").length>0&&r.showScoreDetail()})},{"./js/app":1,"./js/common/polyfill":4,"./js/common/utils":6}]},{},[31]);